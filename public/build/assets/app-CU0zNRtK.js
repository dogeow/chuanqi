function fn(s,e){return function(){return s.apply(e,arguments)}}const{toString:ni}=Object.prototype,{getPrototypeOf:yt}=Object,qe=(s=>e=>{const t=ni.call(e);return s[t]||(s[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Z=s=>(s=s.toLowerCase(),e=>qe(e)===s),De=s=>e=>typeof e===s,{isArray:pe}=Array,ke=De("undefined");function ri(s){return s!==null&&!ke(s)&&s.constructor!==null&&!ke(s.constructor)&&Q(s.constructor.isBuffer)&&s.constructor.isBuffer(s)}const mn=Z("ArrayBuffer");function si(s){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(s):e=s&&s.buffer&&mn(s.buffer),e}const ii=De("string"),Q=De("function"),gn=De("number"),Be=s=>s!==null&&typeof s=="object",oi=s=>s===!0||s===!1,Re=s=>{if(qe(s)!=="object")return!1;const e=yt(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)},ai=Z("Date"),ci=Z("File"),li=Z("Blob"),ui=Z("FileList"),hi=s=>Be(s)&&Q(s.pipe),di=s=>{let e;return s&&(typeof FormData=="function"&&s instanceof FormData||Q(s.append)&&((e=qe(s))==="formdata"||e==="object"&&Q(s.toString)&&s.toString()==="[object FormData]"))},pi=Z("URLSearchParams"),[fi,mi,gi,yi]=["ReadableStream","Request","Response","Headers"].map(Z),bi=s=>s.trim?s.trim():s.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Se(s,e,{allOwnKeys:t=!1}={}){if(s===null||typeof s>"u")return;let n,o;if(typeof s!="object"&&(s=[s]),pe(s))for(n=0,o=s.length;n<o;n++)e.call(null,s[n],n,s);else{const c=t?Object.getOwnPropertyNames(s):Object.keys(s),u=c.length;let d;for(n=0;n<u;n++)d=c[n],e.call(null,s[d],d,s)}}function yn(s,e){e=e.toLowerCase();const t=Object.keys(s);let n=t.length,o;for(;n-- >0;)if(o=t[n],e===o.toLowerCase())return o;return null}const le=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,bn=s=>!ke(s)&&s!==le;function ut(){const{caseless:s}=bn(this)&&this||{},e={},t=(n,o)=>{const c=s&&yn(e,o)||o;Re(e[c])&&Re(n)?e[c]=ut(e[c],n):Re(n)?e[c]=ut({},n):pe(n)?e[c]=n.slice():e[c]=n};for(let n=0,o=arguments.length;n<o;n++)arguments[n]&&Se(arguments[n],t);return e}const vi=(s,e,t,{allOwnKeys:n}={})=>(Se(e,(o,c)=>{t&&Q(o)?s[c]=fn(o,t):s[c]=o},{allOwnKeys:n}),s),wi=s=>(s.charCodeAt(0)===65279&&(s=s.slice(1)),s),_i=(s,e,t,n)=>{s.prototype=Object.create(e.prototype,n),s.prototype.constructor=s,Object.defineProperty(s,"super",{value:e.prototype}),t&&Object.assign(s.prototype,t)},ki=(s,e,t,n)=>{let o,c,u;const d={};if(e=e||{},s==null)return e;do{for(o=Object.getOwnPropertyNames(s),c=o.length;c-- >0;)u=o[c],(!n||n(u,s,e))&&!d[u]&&(e[u]=s[u],d[u]=!0);s=t!==!1&&yt(s)}while(s&&(!t||t(s,e))&&s!==Object.prototype);return e},Si=(s,e,t)=>{s=String(s),(t===void 0||t>s.length)&&(t=s.length),t-=e.length;const n=s.indexOf(e,t);return n!==-1&&n===t},Ci=s=>{if(!s)return null;if(pe(s))return s;let e=s.length;if(!gn(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=s[e];return t},Ei=(s=>e=>s&&e instanceof s)(typeof Uint8Array<"u"&&yt(Uint8Array)),Ti=(s,e)=>{const n=(s&&s[Symbol.iterator]).call(s);let o;for(;(o=n.next())&&!o.done;){const c=o.value;e.call(s,c[0],c[1])}},xi=(s,e)=>{let t;const n=[];for(;(t=s.exec(e))!==null;)n.push(t);return n},Pi=Z("HTMLFormElement"),Mi=s=>s.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,o){return n.toUpperCase()+o}),Vt=(({hasOwnProperty:s})=>(e,t)=>s.call(e,t))(Object.prototype),Ai=Z("RegExp"),vn=(s,e)=>{const t=Object.getOwnPropertyDescriptors(s),n={};Se(t,(o,c)=>{let u;(u=e(o,c,s))!==!1&&(n[c]=u||o)}),Object.defineProperties(s,n)},Ri=s=>{vn(s,(e,t)=>{if(Q(s)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=s[t];if(Q(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Li=(s,e)=>{const t={},n=o=>{o.forEach(c=>{t[c]=!0})};return pe(s)?n(s):n(String(s).split(e)),t},Oi=()=>{},Ii=(s,e)=>s!=null&&Number.isFinite(s=+s)?s:e,st="abcdefghijklmnopqrstuvwxyz",Kt="0123456789",wn={DIGIT:Kt,ALPHA:st,ALPHA_DIGIT:st+st.toUpperCase()+Kt},$i=(s=16,e=wn.ALPHA_DIGIT)=>{let t="";const{length:n}=e;for(;s--;)t+=e[Math.random()*n|0];return t};function Ni(s){return!!(s&&Q(s.append)&&s[Symbol.toStringTag]==="FormData"&&s[Symbol.iterator])}const ji=s=>{const e=new Array(10),t=(n,o)=>{if(Be(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[o]=n;const c=pe(n)?[]:{};return Se(n,(u,d)=>{const g=t(u,o+1);!ke(g)&&(c[d]=g)}),e[o]=void 0,c}}return n};return t(s,0)},qi=Z("AsyncFunction"),Di=s=>s&&(Be(s)||Q(s))&&Q(s.then)&&Q(s.catch),_n=((s,e)=>s?setImmediate:e?((t,n)=>(le.addEventListener("message",({source:o,data:c})=>{o===le&&c===t&&n.length&&n.shift()()},!1),o=>{n.push(o),le.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Q(le.postMessage)),Bi=typeof queueMicrotask<"u"?queueMicrotask.bind(le):typeof process<"u"&&process.nextTick||_n,p={isArray:pe,isArrayBuffer:mn,isBuffer:ri,isFormData:di,isArrayBufferView:si,isString:ii,isNumber:gn,isBoolean:oi,isObject:Be,isPlainObject:Re,isReadableStream:fi,isRequest:mi,isResponse:gi,isHeaders:yi,isUndefined:ke,isDate:ai,isFile:ci,isBlob:li,isRegExp:Ai,isFunction:Q,isStream:hi,isURLSearchParams:pi,isTypedArray:Ei,isFileList:ui,forEach:Se,merge:ut,extend:vi,trim:bi,stripBOM:wi,inherits:_i,toFlatObject:ki,kindOf:qe,kindOfTest:Z,endsWith:Si,toArray:Ci,forEachEntry:Ti,matchAll:xi,isHTMLForm:Pi,hasOwnProperty:Vt,hasOwnProp:Vt,reduceDescriptors:vn,freezeMethods:Ri,toObjectSet:Li,toCamelCase:Mi,noop:Oi,toFiniteNumber:Ii,findKey:yn,global:le,isContextDefined:bn,ALPHABET:wn,generateString:$i,isSpecCompliantForm:Ni,toJSONObject:ji,isAsyncFn:qi,isThenable:Di,setImmediate:_n,asap:Bi};function R(s,e,t,n,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=s,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),o&&(this.response=o,this.status=o.status?o.status:null)}p.inherits(R,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:p.toJSONObject(this.config),code:this.code,status:this.status}}});const kn=R.prototype,Sn={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(s=>{Sn[s]={value:s}});Object.defineProperties(R,Sn);Object.defineProperty(kn,"isAxiosError",{value:!0});R.from=(s,e,t,n,o,c)=>{const u=Object.create(kn);return p.toFlatObject(s,u,function(g){return g!==Error.prototype},d=>d!=="isAxiosError"),R.call(u,s.message,e,t,n,o),u.cause=s,u.name=s.name,c&&Object.assign(u,c),u};const Ui=null;function ht(s){return p.isPlainObject(s)||p.isArray(s)}function Cn(s){return p.endsWith(s,"[]")?s.slice(0,-2):s}function Qt(s,e,t){return s?s.concat(e).map(function(o,c){return o=Cn(o),!t&&c?"["+o+"]":o}).join(t?".":""):e}function Hi(s){return p.isArray(s)&&!s.some(ht)}const Fi=p.toFlatObject(p,{},null,function(e){return/^is[A-Z]/.test(e)});function Ue(s,e,t){if(!p.isObject(s))throw new TypeError("target must be an object");e=e||new FormData,t=p.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(w,f){return!p.isUndefined(f[w])});const n=t.metaTokens,o=t.visitor||y,c=t.dots,u=t.indexes,g=(t.Blob||typeof Blob<"u"&&Blob)&&p.isSpecCompliantForm(e);if(!p.isFunction(o))throw new TypeError("visitor must be a function");function b(k){if(k===null)return"";if(p.isDate(k))return k.toISOString();if(!g&&p.isBlob(k))throw new R("Blob is not supported. Use a Buffer instead.");return p.isArrayBuffer(k)||p.isTypedArray(k)?g&&typeof Blob=="function"?new Blob([k]):Buffer.from(k):k}function y(k,w,f){let _=k;if(k&&!f&&typeof k=="object"){if(p.endsWith(w,"{}"))w=n?w:w.slice(0,-2),k=JSON.stringify(k);else if(p.isArray(k)&&Hi(k)||(p.isFileList(k)||p.endsWith(w,"[]"))&&(_=p.toArray(k)))return w=Cn(w),_.forEach(function(P,$){!(p.isUndefined(P)||P===null)&&e.append(u===!0?Qt([w],$,c):u===null?w:w+"[]",b(P))}),!1}return ht(k)?!0:(e.append(Qt(f,w,c),b(k)),!1)}const v=[],C=Object.assign(Fi,{defaultVisitor:y,convertValue:b,isVisitable:ht});function x(k,w){if(!p.isUndefined(k)){if(v.indexOf(k)!==-1)throw Error("Circular reference detected in "+w.join("."));v.push(k),p.forEach(k,function(_,E){(!(p.isUndefined(_)||_===null)&&o.call(e,_,p.isString(E)?E.trim():E,w,C))===!0&&x(_,w?w.concat(E):[E])}),v.pop()}}if(!p.isObject(s))throw new TypeError("data must be an object");return x(s),e}function Yt(s){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(s).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function bt(s,e){this._pairs=[],s&&Ue(s,this,e)}const En=bt.prototype;En.append=function(e,t){this._pairs.push([e,t])};En.toString=function(e){const t=e?function(n){return e.call(this,n,Yt)}:Yt;return this._pairs.map(function(o){return t(o[0])+"="+t(o[1])},"").join("&")};function zi(s){return encodeURIComponent(s).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Tn(s,e,t){if(!e)return s;const n=t&&t.encode||zi;p.isFunction(t)&&(t={serialize:t});const o=t&&t.serialize;let c;if(o?c=o(e,t):c=p.isURLSearchParams(e)?e.toString():new bt(e,t).toString(n),c){const u=s.indexOf("#");u!==-1&&(s=s.slice(0,u)),s+=(s.indexOf("?")===-1?"?":"&")+c}return s}class Zt{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){p.forEach(this.handlers,function(n){n!==null&&e(n)})}}const xn={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Wi=typeof URLSearchParams<"u"?URLSearchParams:bt,Xi=typeof FormData<"u"?FormData:null,Ji=typeof Blob<"u"?Blob:null,Gi={isBrowser:!0,classes:{URLSearchParams:Wi,FormData:Xi,Blob:Ji},protocols:["http","https","file","blob","url","data"]},vt=typeof window<"u"&&typeof document<"u",dt=typeof navigator=="object"&&navigator||void 0,Vi=vt&&(!dt||["ReactNative","NativeScript","NS"].indexOf(dt.product)<0),Ki=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Qi=vt&&window.location.href||"http://localhost",Yi=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:vt,hasStandardBrowserEnv:Vi,hasStandardBrowserWebWorkerEnv:Ki,navigator:dt,origin:Qi},Symbol.toStringTag,{value:"Module"})),X={...Yi,...Gi};function Zi(s,e){return Ue(s,new X.classes.URLSearchParams,Object.assign({visitor:function(t,n,o,c){return X.isNode&&p.isBuffer(t)?(this.append(n,t.toString("base64")),!1):c.defaultVisitor.apply(this,arguments)}},e))}function eo(s){return p.matchAll(/\w+|\[(\w*)]/g,s).map(e=>e[0]==="[]"?"":e[1]||e[0])}function to(s){const e={},t=Object.keys(s);let n;const o=t.length;let c;for(n=0;n<o;n++)c=t[n],e[c]=s[c];return e}function Pn(s){function e(t,n,o,c){let u=t[c++];if(u==="__proto__")return!0;const d=Number.isFinite(+u),g=c>=t.length;return u=!u&&p.isArray(o)?o.length:u,g?(p.hasOwnProp(o,u)?o[u]=[o[u],n]:o[u]=n,!d):((!o[u]||!p.isObject(o[u]))&&(o[u]=[]),e(t,n,o[u],c)&&p.isArray(o[u])&&(o[u]=to(o[u])),!d)}if(p.isFormData(s)&&p.isFunction(s.entries)){const t={};return p.forEachEntry(s,(n,o)=>{e(eo(n),o,t,0)}),t}return null}function no(s,e,t){if(p.isString(s))try{return(e||JSON.parse)(s),p.trim(s)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(s)}const Ce={transitional:xn,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",o=n.indexOf("application/json")>-1,c=p.isObject(e);if(c&&p.isHTMLForm(e)&&(e=new FormData(e)),p.isFormData(e))return o?JSON.stringify(Pn(e)):e;if(p.isArrayBuffer(e)||p.isBuffer(e)||p.isStream(e)||p.isFile(e)||p.isBlob(e)||p.isReadableStream(e))return e;if(p.isArrayBufferView(e))return e.buffer;if(p.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let d;if(c){if(n.indexOf("application/x-www-form-urlencoded")>-1)return Zi(e,this.formSerializer).toString();if((d=p.isFileList(e))||n.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return Ue(d?{"files[]":e}:e,g&&new g,this.formSerializer)}}return c||o?(t.setContentType("application/json",!1),no(e)):e}],transformResponse:[function(e){const t=this.transitional||Ce.transitional,n=t&&t.forcedJSONParsing,o=this.responseType==="json";if(p.isResponse(e)||p.isReadableStream(e))return e;if(e&&p.isString(e)&&(n&&!this.responseType||o)){const u=!(t&&t.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(d){if(u)throw d.name==="SyntaxError"?R.from(d,R.ERR_BAD_RESPONSE,this,null,this.response):d}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:X.classes.FormData,Blob:X.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};p.forEach(["delete","get","head","post","put","patch"],s=>{Ce.headers[s]={}});const ro=p.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),so=s=>{const e={};let t,n,o;return s&&s.split(`
`).forEach(function(u){o=u.indexOf(":"),t=u.substring(0,o).trim().toLowerCase(),n=u.substring(o+1).trim(),!(!t||e[t]&&ro[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},en=Symbol("internals");function ve(s){return s&&String(s).trim().toLowerCase()}function Le(s){return s===!1||s==null?s:p.isArray(s)?s.map(Le):String(s)}function io(s){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(s);)e[n[1]]=n[2];return e}const oo=s=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(s.trim());function it(s,e,t,n,o){if(p.isFunction(n))return n.call(this,e,t);if(o&&(e=t),!!p.isString(e)){if(p.isString(n))return e.indexOf(n)!==-1;if(p.isRegExp(n))return n.test(e)}}function ao(s){return s.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function co(s,e){const t=p.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(s,n+t,{value:function(o,c,u){return this[n].call(this,e,o,c,u)},configurable:!0})})}let G=class{constructor(e){e&&this.set(e)}set(e,t,n){const o=this;function c(d,g,b){const y=ve(g);if(!y)throw new Error("header name must be a non-empty string");const v=p.findKey(o,y);(!v||o[v]===void 0||b===!0||b===void 0&&o[v]!==!1)&&(o[v||g]=Le(d))}const u=(d,g)=>p.forEach(d,(b,y)=>c(b,y,g));if(p.isPlainObject(e)||e instanceof this.constructor)u(e,t);else if(p.isString(e)&&(e=e.trim())&&!oo(e))u(so(e),t);else if(p.isHeaders(e))for(const[d,g]of e.entries())c(g,d,n);else e!=null&&c(t,e,n);return this}get(e,t){if(e=ve(e),e){const n=p.findKey(this,e);if(n){const o=this[n];if(!t)return o;if(t===!0)return io(o);if(p.isFunction(t))return t.call(this,o,n);if(p.isRegExp(t))return t.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ve(e),e){const n=p.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||it(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let o=!1;function c(u){if(u=ve(u),u){const d=p.findKey(n,u);d&&(!t||it(n,n[d],d,t))&&(delete n[d],o=!0)}}return p.isArray(e)?e.forEach(c):c(e),o}clear(e){const t=Object.keys(this);let n=t.length,o=!1;for(;n--;){const c=t[n];(!e||it(this,this[c],c,e,!0))&&(delete this[c],o=!0)}return o}normalize(e){const t=this,n={};return p.forEach(this,(o,c)=>{const u=p.findKey(n,c);if(u){t[u]=Le(o),delete t[c];return}const d=e?ao(c):String(c).trim();d!==c&&delete t[c],t[d]=Le(o),n[d]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return p.forEach(this,(n,o)=>{n!=null&&n!==!1&&(t[o]=e&&p.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(o=>n.set(o)),n}static accessor(e){const n=(this[en]=this[en]={accessors:{}}).accessors,o=this.prototype;function c(u){const d=ve(u);n[d]||(co(o,u),n[d]=!0)}return p.isArray(e)?e.forEach(c):c(e),this}};G.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);p.reduceDescriptors(G.prototype,({value:s},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>s,set(n){this[t]=n}}});p.freezeMethods(G);function ot(s,e){const t=this||Ce,n=e||t,o=G.from(n.headers);let c=n.data;return p.forEach(s,function(d){c=d.call(t,c,o.normalize(),e?e.status:void 0)}),o.normalize(),c}function Mn(s){return!!(s&&s.__CANCEL__)}function fe(s,e,t){R.call(this,s??"canceled",R.ERR_CANCELED,e,t),this.name="CanceledError"}p.inherits(fe,R,{__CANCEL__:!0});function An(s,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?s(t):e(new R("Request failed with status code "+t.status,[R.ERR_BAD_REQUEST,R.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function lo(s){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(s);return e&&e[1]||""}function uo(s,e){s=s||10;const t=new Array(s),n=new Array(s);let o=0,c=0,u;return e=e!==void 0?e:1e3,function(g){const b=Date.now(),y=n[c];u||(u=b),t[o]=g,n[o]=b;let v=c,C=0;for(;v!==o;)C+=t[v++],v=v%s;if(o=(o+1)%s,o===c&&(c=(c+1)%s),b-u<e)return;const x=y&&b-y;return x?Math.round(C*1e3/x):void 0}}function ho(s,e){let t=0,n=1e3/e,o,c;const u=(b,y=Date.now())=>{t=y,o=null,c&&(clearTimeout(c),c=null),s.apply(null,b)};return[(...b)=>{const y=Date.now(),v=y-t;v>=n?u(b,y):(o=b,c||(c=setTimeout(()=>{c=null,u(o)},n-v)))},()=>o&&u(o)]}const Ie=(s,e,t=3)=>{let n=0;const o=uo(50,250);return ho(c=>{const u=c.loaded,d=c.lengthComputable?c.total:void 0,g=u-n,b=o(g),y=u<=d;n=u;const v={loaded:u,total:d,progress:d?u/d:void 0,bytes:g,rate:b||void 0,estimated:b&&d&&y?(d-u)/b:void 0,event:c,lengthComputable:d!=null,[e?"download":"upload"]:!0};s(v)},t)},tn=(s,e)=>{const t=s!=null;return[n=>e[0]({lengthComputable:t,total:s,loaded:n}),e[1]]},nn=s=>(...e)=>p.asap(()=>s(...e)),po=X.hasStandardBrowserEnv?((s,e)=>t=>(t=new URL(t,X.origin),s.protocol===t.protocol&&s.host===t.host&&(e||s.port===t.port)))(new URL(X.origin),X.navigator&&/(msie|trident)/i.test(X.navigator.userAgent)):()=>!0,fo=X.hasStandardBrowserEnv?{write(s,e,t,n,o,c){const u=[s+"="+encodeURIComponent(e)];p.isNumber(t)&&u.push("expires="+new Date(t).toGMTString()),p.isString(n)&&u.push("path="+n),p.isString(o)&&u.push("domain="+o),c===!0&&u.push("secure"),document.cookie=u.join("; ")},read(s){const e=document.cookie.match(new RegExp("(^|;\\s*)("+s+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(s){this.write(s,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function mo(s){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(s)}function go(s,e){return e?s.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):s}function Rn(s,e){return s&&!mo(e)?go(s,e):e}const rn=s=>s instanceof G?{...s}:s;function he(s,e){e=e||{};const t={};function n(b,y,v,C){return p.isPlainObject(b)&&p.isPlainObject(y)?p.merge.call({caseless:C},b,y):p.isPlainObject(y)?p.merge({},y):p.isArray(y)?y.slice():y}function o(b,y,v,C){if(p.isUndefined(y)){if(!p.isUndefined(b))return n(void 0,b,v,C)}else return n(b,y,v,C)}function c(b,y){if(!p.isUndefined(y))return n(void 0,y)}function u(b,y){if(p.isUndefined(y)){if(!p.isUndefined(b))return n(void 0,b)}else return n(void 0,y)}function d(b,y,v){if(v in e)return n(b,y);if(v in s)return n(void 0,b)}const g={url:c,method:c,data:c,baseURL:u,transformRequest:u,transformResponse:u,paramsSerializer:u,timeout:u,timeoutMessage:u,withCredentials:u,withXSRFToken:u,adapter:u,responseType:u,xsrfCookieName:u,xsrfHeaderName:u,onUploadProgress:u,onDownloadProgress:u,decompress:u,maxContentLength:u,maxBodyLength:u,beforeRedirect:u,transport:u,httpAgent:u,httpsAgent:u,cancelToken:u,socketPath:u,responseEncoding:u,validateStatus:d,headers:(b,y,v)=>o(rn(b),rn(y),v,!0)};return p.forEach(Object.keys(Object.assign({},s,e)),function(y){const v=g[y]||o,C=v(s[y],e[y],y);p.isUndefined(C)&&v!==d||(t[y]=C)}),t}const Ln=s=>{const e=he({},s);let{data:t,withXSRFToken:n,xsrfHeaderName:o,xsrfCookieName:c,headers:u,auth:d}=e;e.headers=u=G.from(u),e.url=Tn(Rn(e.baseURL,e.url),s.params,s.paramsSerializer),d&&u.set("Authorization","Basic "+btoa((d.username||"")+":"+(d.password?unescape(encodeURIComponent(d.password)):"")));let g;if(p.isFormData(t)){if(X.hasStandardBrowserEnv||X.hasStandardBrowserWebWorkerEnv)u.setContentType(void 0);else if((g=u.getContentType())!==!1){const[b,...y]=g?g.split(";").map(v=>v.trim()).filter(Boolean):[];u.setContentType([b||"multipart/form-data",...y].join("; "))}}if(X.hasStandardBrowserEnv&&(n&&p.isFunction(n)&&(n=n(e)),n||n!==!1&&po(e.url))){const b=o&&c&&fo.read(c);b&&u.set(o,b)}return e},yo=typeof XMLHttpRequest<"u",bo=yo&&function(s){return new Promise(function(t,n){const o=Ln(s);let c=o.data;const u=G.from(o.headers).normalize();let{responseType:d,onUploadProgress:g,onDownloadProgress:b}=o,y,v,C,x,k;function w(){x&&x(),k&&k(),o.cancelToken&&o.cancelToken.unsubscribe(y),o.signal&&o.signal.removeEventListener("abort",y)}let f=new XMLHttpRequest;f.open(o.method.toUpperCase(),o.url,!0),f.timeout=o.timeout;function _(){if(!f)return;const P=G.from("getAllResponseHeaders"in f&&f.getAllResponseHeaders()),O={data:!d||d==="text"||d==="json"?f.responseText:f.response,status:f.status,statusText:f.statusText,headers:P,config:s,request:f};An(function(H){t(H),w()},function(H){n(H),w()},O),f=null}"onloadend"in f?f.onloadend=_:f.onreadystatechange=function(){!f||f.readyState!==4||f.status===0&&!(f.responseURL&&f.responseURL.indexOf("file:")===0)||setTimeout(_)},f.onabort=function(){f&&(n(new R("Request aborted",R.ECONNABORTED,s,f)),f=null)},f.onerror=function(){n(new R("Network Error",R.ERR_NETWORK,s,f)),f=null},f.ontimeout=function(){let $=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const O=o.transitional||xn;o.timeoutErrorMessage&&($=o.timeoutErrorMessage),n(new R($,O.clarifyTimeoutError?R.ETIMEDOUT:R.ECONNABORTED,s,f)),f=null},c===void 0&&u.setContentType(null),"setRequestHeader"in f&&p.forEach(u.toJSON(),function($,O){f.setRequestHeader(O,$)}),p.isUndefined(o.withCredentials)||(f.withCredentials=!!o.withCredentials),d&&d!=="json"&&(f.responseType=o.responseType),b&&([C,k]=Ie(b,!0),f.addEventListener("progress",C)),g&&f.upload&&([v,x]=Ie(g),f.upload.addEventListener("progress",v),f.upload.addEventListener("loadend",x)),(o.cancelToken||o.signal)&&(y=P=>{f&&(n(!P||P.type?new fe(null,s,f):P),f.abort(),f=null)},o.cancelToken&&o.cancelToken.subscribe(y),o.signal&&(o.signal.aborted?y():o.signal.addEventListener("abort",y)));const E=lo(o.url);if(E&&X.protocols.indexOf(E)===-1){n(new R("Unsupported protocol "+E+":",R.ERR_BAD_REQUEST,s));return}f.send(c||null)})},vo=(s,e)=>{const{length:t}=s=s?s.filter(Boolean):[];if(e||t){let n=new AbortController,o;const c=function(b){if(!o){o=!0,d();const y=b instanceof Error?b:this.reason;n.abort(y instanceof R?y:new fe(y instanceof Error?y.message:y))}};let u=e&&setTimeout(()=>{u=null,c(new R(`timeout ${e} of ms exceeded`,R.ETIMEDOUT))},e);const d=()=>{s&&(u&&clearTimeout(u),u=null,s.forEach(b=>{b.unsubscribe?b.unsubscribe(c):b.removeEventListener("abort",c)}),s=null)};s.forEach(b=>b.addEventListener("abort",c));const{signal:g}=n;return g.unsubscribe=()=>p.asap(d),g}},wo=function*(s,e){let t=s.byteLength;if(t<e){yield s;return}let n=0,o;for(;n<t;)o=n+e,yield s.slice(n,o),n=o},_o=async function*(s,e){for await(const t of ko(s))yield*wo(t,e)},ko=async function*(s){if(s[Symbol.asyncIterator]){yield*s;return}const e=s.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},sn=(s,e,t,n)=>{const o=_o(s,e);let c=0,u,d=g=>{u||(u=!0,n&&n(g))};return new ReadableStream({async pull(g){try{const{done:b,value:y}=await o.next();if(b){d(),g.close();return}let v=y.byteLength;if(t){let C=c+=v;t(C)}g.enqueue(new Uint8Array(y))}catch(b){throw d(b),b}},cancel(g){return d(g),o.return()}},{highWaterMark:2})},He=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",On=He&&typeof ReadableStream=="function",So=He&&(typeof TextEncoder=="function"?(s=>e=>s.encode(e))(new TextEncoder):async s=>new Uint8Array(await new Response(s).arrayBuffer())),In=(s,...e)=>{try{return!!s(...e)}catch{return!1}},Co=On&&In(()=>{let s=!1;const e=new Request(X.origin,{body:new ReadableStream,method:"POST",get duplex(){return s=!0,"half"}}).headers.has("Content-Type");return s&&!e}),on=64*1024,pt=On&&In(()=>p.isReadableStream(new Response("").body)),$e={stream:pt&&(s=>s.body)};He&&(s=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!$e[e]&&($e[e]=p.isFunction(s[e])?t=>t[e]():(t,n)=>{throw new R(`Response type '${e}' is not supported`,R.ERR_NOT_SUPPORT,n)})})})(new Response);const Eo=async s=>{if(s==null)return 0;if(p.isBlob(s))return s.size;if(p.isSpecCompliantForm(s))return(await new Request(X.origin,{method:"POST",body:s}).arrayBuffer()).byteLength;if(p.isArrayBufferView(s)||p.isArrayBuffer(s))return s.byteLength;if(p.isURLSearchParams(s)&&(s=s+""),p.isString(s))return(await So(s)).byteLength},To=async(s,e)=>{const t=p.toFiniteNumber(s.getContentLength());return t??Eo(e)},xo=He&&(async s=>{let{url:e,method:t,data:n,signal:o,cancelToken:c,timeout:u,onDownloadProgress:d,onUploadProgress:g,responseType:b,headers:y,withCredentials:v="same-origin",fetchOptions:C}=Ln(s);b=b?(b+"").toLowerCase():"text";let x=vo([o,c&&c.toAbortSignal()],u),k;const w=x&&x.unsubscribe&&(()=>{x.unsubscribe()});let f;try{if(g&&Co&&t!=="get"&&t!=="head"&&(f=await To(y,n))!==0){let O=new Request(e,{method:"POST",body:n,duplex:"half"}),q;if(p.isFormData(n)&&(q=O.headers.get("content-type"))&&y.setContentType(q),O.body){const[H,F]=tn(f,Ie(nn(g)));n=sn(O.body,on,H,F)}}p.isString(v)||(v=v?"include":"omit");const _="credentials"in Request.prototype;k=new Request(e,{...C,signal:x,method:t.toUpperCase(),headers:y.normalize().toJSON(),body:n,duplex:"half",credentials:_?v:void 0});let E=await fetch(k);const P=pt&&(b==="stream"||b==="response");if(pt&&(d||P&&w)){const O={};["status","statusText","headers"].forEach(Y=>{O[Y]=E[Y]});const q=p.toFiniteNumber(E.headers.get("content-length")),[H,F]=d&&tn(q,Ie(nn(d),!0))||[];E=new Response(sn(E.body,on,H,()=>{F&&F(),w&&w()}),O)}b=b||"text";let $=await $e[p.findKey($e,b)||"text"](E,s);return!P&&w&&w(),await new Promise((O,q)=>{An(O,q,{data:$,headers:G.from(E.headers),status:E.status,statusText:E.statusText,config:s,request:k})})}catch(_){throw w&&w(),_&&_.name==="TypeError"&&/fetch/i.test(_.message)?Object.assign(new R("Network Error",R.ERR_NETWORK,s,k),{cause:_.cause||_}):R.from(_,_&&_.code,s,k)}}),ft={http:Ui,xhr:bo,fetch:xo};p.forEach(ft,(s,e)=>{if(s){try{Object.defineProperty(s,"name",{value:e})}catch{}Object.defineProperty(s,"adapterName",{value:e})}});const an=s=>`- ${s}`,Po=s=>p.isFunction(s)||s===null||s===!1,$n={getAdapter:s=>{s=p.isArray(s)?s:[s];const{length:e}=s;let t,n;const o={};for(let c=0;c<e;c++){t=s[c];let u;if(n=t,!Po(t)&&(n=ft[(u=String(t)).toLowerCase()],n===void 0))throw new R(`Unknown adapter '${u}'`);if(n)break;o[u||"#"+c]=n}if(!n){const c=Object.entries(o).map(([d,g])=>`adapter ${d} `+(g===!1?"is not supported by the environment":"is not available in the build"));let u=e?c.length>1?`since :
`+c.map(an).join(`
`):" "+an(c[0]):"as no adapter specified";throw new R("There is no suitable adapter to dispatch the request "+u,"ERR_NOT_SUPPORT")}return n},adapters:ft};function at(s){if(s.cancelToken&&s.cancelToken.throwIfRequested(),s.signal&&s.signal.aborted)throw new fe(null,s)}function cn(s){return at(s),s.headers=G.from(s.headers),s.data=ot.call(s,s.transformRequest),["post","put","patch"].indexOf(s.method)!==-1&&s.headers.setContentType("application/x-www-form-urlencoded",!1),$n.getAdapter(s.adapter||Ce.adapter)(s).then(function(n){return at(s),n.data=ot.call(s,s.transformResponse,n),n.headers=G.from(n.headers),n},function(n){return Mn(n)||(at(s),n&&n.response&&(n.response.data=ot.call(s,s.transformResponse,n.response),n.response.headers=G.from(n.response.headers))),Promise.reject(n)})}const Nn="1.7.9",Fe={};["object","boolean","number","function","string","symbol"].forEach((s,e)=>{Fe[s]=function(n){return typeof n===s||"a"+(e<1?"n ":" ")+s}});const ln={};Fe.transitional=function(e,t,n){function o(c,u){return"[Axios v"+Nn+"] Transitional option '"+c+"'"+u+(n?". "+n:"")}return(c,u,d)=>{if(e===!1)throw new R(o(u," has been removed"+(t?" in "+t:"")),R.ERR_DEPRECATED);return t&&!ln[u]&&(ln[u]=!0,console.warn(o(u," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(c,u,d):!0}};Fe.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function Mo(s,e,t){if(typeof s!="object")throw new R("options must be an object",R.ERR_BAD_OPTION_VALUE);const n=Object.keys(s);let o=n.length;for(;o-- >0;){const c=n[o],u=e[c];if(u){const d=s[c],g=d===void 0||u(d,c,s);if(g!==!0)throw new R("option "+c+" must be "+g,R.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new R("Unknown option "+c,R.ERR_BAD_OPTION)}}const Oe={assertOptions:Mo,validators:Fe},ee=Oe.validators;let ue=class{constructor(e){this.defaults=e,this.interceptors={request:new Zt,response:new Zt}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const c=o.stack?o.stack.replace(/^.+\n/,""):"";try{n.stack?c&&!String(n.stack).endsWith(c.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+c):n.stack=c}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=he(this.defaults,t);const{transitional:n,paramsSerializer:o,headers:c}=t;n!==void 0&&Oe.assertOptions(n,{silentJSONParsing:ee.transitional(ee.boolean),forcedJSONParsing:ee.transitional(ee.boolean),clarifyTimeoutError:ee.transitional(ee.boolean)},!1),o!=null&&(p.isFunction(o)?t.paramsSerializer={serialize:o}:Oe.assertOptions(o,{encode:ee.function,serialize:ee.function},!0)),Oe.assertOptions(t,{baseUrl:ee.spelling("baseURL"),withXsrfToken:ee.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let u=c&&p.merge(c.common,c[t.method]);c&&p.forEach(["delete","get","head","post","put","patch","common"],k=>{delete c[k]}),t.headers=G.concat(u,c);const d=[];let g=!0;this.interceptors.request.forEach(function(w){typeof w.runWhen=="function"&&w.runWhen(t)===!1||(g=g&&w.synchronous,d.unshift(w.fulfilled,w.rejected))});const b=[];this.interceptors.response.forEach(function(w){b.push(w.fulfilled,w.rejected)});let y,v=0,C;if(!g){const k=[cn.bind(this),void 0];for(k.unshift.apply(k,d),k.push.apply(k,b),C=k.length,y=Promise.resolve(t);v<C;)y=y.then(k[v++],k[v++]);return y}C=d.length;let x=t;for(v=0;v<C;){const k=d[v++],w=d[v++];try{x=k(x)}catch(f){w.call(this,f);break}}try{y=cn.call(this,x)}catch(k){return Promise.reject(k)}for(v=0,C=b.length;v<C;)y=y.then(b[v++],b[v++]);return y}getUri(e){e=he(this.defaults,e);const t=Rn(e.baseURL,e.url);return Tn(t,e.params,e.paramsSerializer)}};p.forEach(["delete","get","head","options"],function(e){ue.prototype[e]=function(t,n){return this.request(he(n||{},{method:e,url:t,data:(n||{}).data}))}});p.forEach(["post","put","patch"],function(e){function t(n){return function(c,u,d){return this.request(he(d||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:c,data:u}))}}ue.prototype[e]=t(),ue.prototype[e+"Form"]=t(!0)});let Ao=class jn{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(c){t=c});const n=this;this.promise.then(o=>{if(!n._listeners)return;let c=n._listeners.length;for(;c-- >0;)n._listeners[c](o);n._listeners=null}),this.promise.then=o=>{let c;const u=new Promise(d=>{n.subscribe(d),c=d}).then(o);return u.cancel=function(){n.unsubscribe(c)},u},e(function(c,u,d){n.reason||(n.reason=new fe(c,u,d),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new jn(function(o){e=o}),cancel:e}}};function Ro(s){return function(t){return s.apply(null,t)}}function Lo(s){return p.isObject(s)&&s.isAxiosError===!0}const mt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(mt).forEach(([s,e])=>{mt[e]=s});function qn(s){const e=new ue(s),t=fn(ue.prototype.request,e);return p.extend(t,ue.prototype,e,{allOwnKeys:!0}),p.extend(t,e,null,{allOwnKeys:!0}),t.create=function(o){return qn(he(s,o))},t}const j=qn(Ce);j.Axios=ue;j.CanceledError=fe;j.CancelToken=Ao;j.isCancel=Mn;j.VERSION=Nn;j.toFormData=Ue;j.AxiosError=R;j.Cancel=j.CanceledError;j.all=function(e){return Promise.all(e)};j.spread=Ro;j.isAxiosError=Lo;j.mergeConfig=he;j.AxiosHeaders=G;j.formToJSON=s=>Pn(p.isHTMLForm(s)?new FormData(s):s);j.getAdapter=$n.getAdapter;j.HttpStatusCode=mt;j.default=j;const{Axios:ta,AxiosError:na,CanceledError:ra,isCancel:sa,CancelToken:ia,VERSION:oa,all:aa,Cancel:ca,isAxiosError:la,spread:ua,toFormData:ha,AxiosHeaders:da,HttpStatusCode:pa,formToJSON:fa,getAdapter:ma,mergeConfig:ga}=j;function Oo(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function V(s,e,t){return e=Ne(e),No(s,Dn()?Reflect.construct(e,t||[],Ne(s).constructor):e.apply(s,t))}function B(s,e){if(!(s instanceof e))throw new TypeError("Cannot call a class as a function")}function Io(s,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(s,Bn(n.key),n)}}function U(s,e,t){return e&&Io(s.prototype,e),Object.defineProperty(s,"prototype",{writable:!1}),s}function $o(s,e,t){return(e=Bn(e))in s?Object.defineProperty(s,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):s[e]=t,s}function Ne(s){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(s)}function K(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),Object.defineProperty(s,"prototype",{writable:!1}),e&&gt(s,e)}function Dn(){try{var s=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Dn=function(){return!!s})()}function un(s,e){var t=Object.keys(s);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(s);e&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(s,o).enumerable})),t.push.apply(t,n)}return t}function we(s){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?un(Object(t),!0).forEach(function(n){$o(s,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(t)):un(Object(t)).forEach(function(n){Object.defineProperty(s,n,Object.getOwnPropertyDescriptor(t,n))})}return s}function No(s,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oo(s)}function gt(s,e){return gt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,n){return t.__proto__=n,t},gt(s,e)}function jo(s,e){if(typeof s!="object"||!s)return s;var t=s[Symbol.toPrimitive];if(t!==void 0){var n=t.call(s,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(s)}function Bn(s){var e=jo(s,"string");return typeof e=="symbol"?e:e+""}function _e(s){"@babel/helpers - typeof";return _e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(s)}var wt=function(){function s(){B(this,s)}return U(s,[{key:"listenForWhisper",value:function(t,n){return this.listen(".client-"+t,n)}},{key:"notification",value:function(t){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",t)}},{key:"stopListeningForWhisper",value:function(t,n){return this.stopListening(".client-"+t,n)}}])}(),Un=function(){function s(e){B(this,s),this.namespace=e}return U(s,[{key:"format",value:function(t){return[".","\\"].includes(t.charAt(0))?t.substring(1):(this.namespace&&(t=this.namespace+"."+t),t.replace(/\./g,"\\"))}},{key:"setNamespace",value:function(t){this.namespace=t}}])}();function qo(s){try{new s}catch(e){if(e instanceof Error&&e.message.includes("is not a constructor"))return!1}return!0}var _t=function(s){function e(t,n,o){var c;return B(this,e),c=V(this,e),c.name=n,c.pusher=t,c.options=o,c.eventFormatter=new Un(c.options.namespace),c.subscribe(),c}return K(e,s),U(e,[{key:"subscribe",value:function(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function(n,o){return this.on(this.eventFormatter.format(n),o),this}},{key:"listenToAll",value:function(n){var o=this;return this.subscription.bind_global(function(c,u){var d;if(!c.startsWith("pusher:")){var g=String((d=o.options.namespace)!==null&&d!==void 0?d:"").replace(/\./g,"\\"),b=c.startsWith(g)?c.substring(g.length+1):"."+c;n(b,u)}}),this}},{key:"stopListening",value:function(n,o){return o?this.subscription.unbind(this.eventFormatter.format(n),o):this.subscription.unbind(this.eventFormatter.format(n)),this}},{key:"stopListeningToAll",value:function(n){return n?this.subscription.unbind_global(n):this.subscription.unbind_global(),this}},{key:"subscribed",value:function(n){return this.on("pusher:subscription_succeeded",function(){n()}),this}},{key:"error",value:function(n){return this.on("pusher:subscription_error",function(o){n(o)}),this}},{key:"on",value:function(n,o){return this.subscription.bind(n,o),this}}])}(wt),Hn=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"whisper",value:function(n,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),o),this}}])}(_t),Do=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"whisper",value:function(n,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),o),this}}])}(_t),Bo=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"here",value:function(n){return this.on("pusher:subscription_succeeded",function(o){n(Object.keys(o.members).map(function(c){return o.members[c]}))}),this}},{key:"joining",value:function(n){return this.on("pusher:member_added",function(o){n(o.info)}),this}},{key:"whisper",value:function(n,o){return this.pusher.channels.channels[this.name].trigger("client-".concat(n),o),this}},{key:"leaving",value:function(n){return this.on("pusher:member_removed",function(o){n(o.info)}),this}}])}(Hn),Fn=function(s){function e(t,n,o){var c;return B(this,e),c=V(this,e),c.events={},c.listeners={},c.name=n,c.socket=t,c.options=o,c.eventFormatter=new Un(c.options.namespace),c.subscribe(),c}return K(e,s),U(e,[{key:"subscribe",value:function(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function(n,o){return this.on(this.eventFormatter.format(n),o),this}},{key:"stopListening",value:function(n,o){return this.unbindEvent(this.eventFormatter.format(n),o),this}},{key:"subscribed",value:function(n){return this.on("connect",function(o){n(o)}),this}},{key:"error",value:function(n){return this}},{key:"on",value:function(n,o){var c=this;return this.listeners[n]=this.listeners[n]||[],this.events[n]||(this.events[n]=function(u,d){c.name===u&&c.listeners[n]&&c.listeners[n].forEach(function(g){return g(d)})},this.socket.on(n,this.events[n])),this.listeners[n].push(o),this}},{key:"unbind",value:function(){var n=this;Object.keys(this.events).forEach(function(o){n.unbindEvent(o)})}},{key:"unbindEvent",value:function(n,o){this.listeners[n]=this.listeners[n]||[],o&&(this.listeners[n]=this.listeners[n].filter(function(c){return c!==o})),(!o||this.listeners[n].length===0)&&(this.events[n]&&(this.socket.removeListener(n,this.events[n]),delete this.events[n]),delete this.listeners[n])}}])}(wt),zn=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"whisper",value:function(n,o){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(n),data:o}),this}}])}(Fn),Uo=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"here",value:function(n){return this.on("presence:subscribed",function(o){n(o.map(function(c){return c.user_info}))}),this}},{key:"joining",value:function(n){return this.on("presence:joining",function(o){return n(o.user_info)}),this}},{key:"whisper",value:function(n,o){return this.socket.emit("client event",{channel:this.name,event:"client-".concat(n),data:o}),this}},{key:"leaving",value:function(n){return this.on("presence:leaving",function(o){return n(o.user_info)}),this}}])}(zn),je=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"subscribe",value:function(){}},{key:"unsubscribe",value:function(){}},{key:"listen",value:function(n,o){return this}},{key:"listenToAll",value:function(n){return this}},{key:"stopListening",value:function(n,o){return this}},{key:"subscribed",value:function(n){return this}},{key:"error",value:function(n){return this}},{key:"on",value:function(n,o){return this}}])}(wt),Wn=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"whisper",value:function(n,o){return this}}])}(je),Ho=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"whisper",value:function(n,o){return this}}])}(je),Fo=function(s){function e(){return B(this,e),V(this,e,arguments)}return K(e,s),U(e,[{key:"here",value:function(n){return this}},{key:"joining",value:function(n){return this}},{key:"whisper",value:function(n,o){return this}},{key:"leaving",value:function(n){return this}}])}(Wn),ze=function(){function s(e){B(this,s),this.setOptions(e),this.connect()}return U(s,[{key:"setOptions",value:function(t){this.options=we(we(we({},s._defaultOptions),t),{},{broadcaster:t.broadcaster});var n=this.csrfToken();n&&(this.options.auth.headers["X-CSRF-TOKEN"]=n,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=n),n=this.options.bearerToken,n&&(this.options.auth.headers.Authorization="Bearer "+n,this.options.userAuthentication.headers.Authorization="Bearer "+n)}},{key:"csrfToken",value:function(){var t;return typeof window<"u"&&typeof window.Laravel<"u"&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"&&(t=document.querySelector('meta[name="csrf-token"]'))?t.getAttribute("content"):null}}])}();ze._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"};var ct=function(s){function e(){var t;return B(this,e),t=V(this,e,arguments),t.channels={},t}return K(e,s),U(e,[{key:"connect",value:function(){if(typeof this.options.client<"u")this.pusher=this.options.client;else if(this.options.Pusher)this.pusher=new this.options.Pusher(this.options.key,this.options);else if(typeof window<"u"&&typeof window.Pusher<"u")this.pusher=new window.Pusher(this.options.key,this.options);else throw new Error("Pusher client not found. Should be globally available or passed via options.client")}},{key:"signin",value:function(){this.pusher.signin()}},{key:"listen",value:function(n,o,c){return this.channel(n).listen(o,c)}},{key:"channel",value:function(n){return this.channels[n]||(this.channels[n]=new _t(this.pusher,n,this.options)),this.channels[n]}},{key:"privateChannel",value:function(n){return this.channels["private-"+n]||(this.channels["private-"+n]=new Hn(this.pusher,"private-"+n,this.options)),this.channels["private-"+n]}},{key:"encryptedPrivateChannel",value:function(n){return this.channels["private-encrypted-"+n]||(this.channels["private-encrypted-"+n]=new Do(this.pusher,"private-encrypted-"+n,this.options)),this.channels["private-encrypted-"+n]}},{key:"presenceChannel",value:function(n){return this.channels["presence-"+n]||(this.channels["presence-"+n]=new Bo(this.pusher,"presence-"+n,this.options)),this.channels["presence-"+n]}},{key:"leave",value:function(n){var o=this,c=[n,"private-"+n,"private-encrypted-"+n,"presence-"+n];c.forEach(function(u){o.leaveChannel(u)})}},{key:"leaveChannel",value:function(n){this.channels[n]&&(this.channels[n].unsubscribe(),delete this.channels[n])}},{key:"socketId",value:function(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function(){this.pusher.disconnect()}}])}(ze),zo=function(s){function e(){var t;return B(this,e),t=V(this,e,arguments),t.channels={},t}return K(e,s),U(e,[{key:"connect",value:function(){var n,o=this,c=this.getSocketIO();this.socket=c((n=this.options.host)!==null&&n!==void 0?n:void 0,this.options),this.socket.on("reconnect",function(){Object.values(o.channels).forEach(function(u){u.subscribe()})})}},{key:"getSocketIO",value:function(){if(typeof this.options.client<"u")return this.options.client;if(typeof window<"u"&&typeof window.io<"u")return window.io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function(n,o,c){return this.channel(n).listen(o,c)}},{key:"channel",value:function(n){return this.channels[n]||(this.channels[n]=new Fn(this.socket,n,this.options)),this.channels[n]}},{key:"privateChannel",value:function(n){return this.channels["private-"+n]||(this.channels["private-"+n]=new zn(this.socket,"private-"+n,this.options)),this.channels["private-"+n]}},{key:"presenceChannel",value:function(n){return this.channels["presence-"+n]||(this.channels["presence-"+n]=new Uo(this.socket,"presence-"+n,this.options)),this.channels["presence-"+n]}},{key:"leave",value:function(n){var o=this,c=[n,"private-"+n,"presence-"+n];c.forEach(function(u){o.leaveChannel(u)})}},{key:"leaveChannel",value:function(n){this.channels[n]&&(this.channels[n].unsubscribe(),delete this.channels[n])}},{key:"socketId",value:function(){return this.socket.id}},{key:"disconnect",value:function(){this.socket.disconnect()}}])}(ze),hn=function(s){function e(){var t;return B(this,e),t=V(this,e,arguments),t.channels={},t}return K(e,s),U(e,[{key:"connect",value:function(){}},{key:"listen",value:function(n,o,c){return new je}},{key:"channel",value:function(n){return new je}},{key:"privateChannel",value:function(n){return new Wn}},{key:"encryptedPrivateChannel",value:function(n){return new Ho}},{key:"presenceChannel",value:function(n){return new Fo}},{key:"leave",value:function(n){}},{key:"leaveChannel",value:function(n){}},{key:"socketId",value:function(){return"fake-socket-id"}},{key:"disconnect",value:function(){}}])}(ze),Wo=function(){function s(e){B(this,s),this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}return U(s,[{key:"channel",value:function(t){return this.connector.channel(t)}},{key:"connect",value:function(){if(this.options.broadcaster==="reverb")this.connector=new ct(we(we({},this.options),{},{cluster:""}));else if(this.options.broadcaster==="pusher")this.connector=new ct(this.options);else if(this.options.broadcaster==="socket.io")this.connector=new zo(this.options);else if(this.options.broadcaster==="null")this.connector=new hn(this.options);else if(typeof this.options.broadcaster=="function"&&qo(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error("Broadcaster ".concat(_e(this.options.broadcaster)," ").concat(String(this.options.broadcaster)," is not supported."))}},{key:"disconnect",value:function(){this.connector.disconnect()}},{key:"join",value:function(t){return this.connector.presenceChannel(t)}},{key:"leave",value:function(t){this.connector.leave(t)}},{key:"leaveChannel",value:function(t){this.connector.leaveChannel(t)}},{key:"leaveAllChannels",value:function(){for(var t in this.connector.channels)this.leaveChannel(t)}},{key:"listen",value:function(t,n,o){return this.connector.listen(t,n,o)}},{key:"private",value:function(t){return this.connector.privateChannel(t)}},{key:"encryptedPrivate",value:function(t){if(this.connectorSupportsEncryptedPrivateChannels(this.connector))return this.connector.encryptedPrivateChannel(t);throw new Error("Broadcaster ".concat(_e(this.options.broadcaster)," ").concat(String(this.options.broadcaster)," does not support encrypted private channels."))}},{key:"connectorSupportsEncryptedPrivateChannels",value:function(t){return t instanceof ct||t instanceof hn}},{key:"socketId",value:function(){return this.connector.socketId()}},{key:"registerInterceptors",value:function(){typeof Vue=="function"&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),(typeof Turbo>"u"?"undefined":_e(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function(){var t=this;Vue.http.interceptors.push(function(n,o){t.socketId()&&n.headers.set("X-Socket-ID",t.socketId()),o()})}},{key:"registerAxiosRequestInterceptor",value:function(){var t=this;axios.interceptors.request.use(function(n){return t.socketId()&&(n.headers["X-Socket-Id"]=t.socketId()),n})}},{key:"registerjQueryAjaxSetup",value:function(){var t=this;typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter(function(n,o,c){t.socketId()&&c.setRequestHeader("X-Socket-Id",t.socketId())})}},{key:"registerTurboRequestInterceptor",value:function(){var t=this;document.addEventListener("turbo:before-fetch-request",function(n){n.detail.fetchOptions.headers["X-Socket-Id"]=t.socketId()})}}])}();function Xo(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var lt={exports:{}};/*!
 * Pusher JavaScript Library v8.4.0
 * https://pusher.com/
 *
 * Copyright 2020, Pusher
 * Released under the MIT licence.
 */var dn;function Jo(){return dn||(dn=1,function(s,e){(function(n,o){s.exports=o()})(window,function(){return function(t){var n={};function o(c){if(n[c])return n[c].exports;var u=n[c]={i:c,l:!1,exports:{}};return t[c].call(u.exports,u,u.exports,o),u.l=!0,u.exports}return o.m=t,o.c=n,o.d=function(c,u,d){o.o(c,u)||Object.defineProperty(c,u,{enumerable:!0,get:d})},o.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},o.t=function(c,u){if(u&1&&(c=o(c)),u&8||u&4&&typeof c=="object"&&c&&c.__esModule)return c;var d=Object.create(null);if(o.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:c}),u&2&&typeof c!="string")for(var g in c)o.d(d,g,(function(b){return c[b]}).bind(null,g));return d},o.n=function(c){var u=c&&c.__esModule?function(){return c.default}:function(){return c};return o.d(u,"a",u),u},o.o=function(c,u){return Object.prototype.hasOwnProperty.call(c,u)},o.p="",o(o.s=2)}([function(t,n,o){var c=this&&this.__extends||function(){var w=function(f,_){return w=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,P){E.__proto__=P}||function(E,P){for(var $ in P)P.hasOwnProperty($)&&(E[$]=P[$])},w(f,_)};return function(f,_){w(f,_);function E(){this.constructor=f}f.prototype=_===null?Object.create(_):(E.prototype=_.prototype,new E)}}();Object.defineProperty(n,"__esModule",{value:!0});var u=256,d=function(){function w(f){f===void 0&&(f="="),this._paddingCharacter=f}return w.prototype.encodedLength=function(f){return this._paddingCharacter?(f+2)/3*4|0:(f*8+5)/6|0},w.prototype.encode=function(f){for(var _="",E=0;E<f.length-2;E+=3){var P=f[E]<<16|f[E+1]<<8|f[E+2];_+=this._encodeByte(P>>>3*6&63),_+=this._encodeByte(P>>>2*6&63),_+=this._encodeByte(P>>>1*6&63),_+=this._encodeByte(P>>>0*6&63)}var $=f.length-E;if($>0){var P=f[E]<<16|($===2?f[E+1]<<8:0);_+=this._encodeByte(P>>>3*6&63),_+=this._encodeByte(P>>>2*6&63),$===2?_+=this._encodeByte(P>>>1*6&63):_+=this._paddingCharacter||"",_+=this._paddingCharacter||""}return _},w.prototype.maxDecodedLength=function(f){return this._paddingCharacter?f/4*3|0:(f*6+7)/8|0},w.prototype.decodedLength=function(f){return this.maxDecodedLength(f.length-this._getPaddingLength(f))},w.prototype.decode=function(f){if(f.length===0)return new Uint8Array(0);for(var _=this._getPaddingLength(f),E=f.length-_,P=new Uint8Array(this.maxDecodedLength(E)),$=0,O=0,q=0,H=0,F=0,Y=0,se=0;O<E-4;O+=4)H=this._decodeChar(f.charCodeAt(O+0)),F=this._decodeChar(f.charCodeAt(O+1)),Y=this._decodeChar(f.charCodeAt(O+2)),se=this._decodeChar(f.charCodeAt(O+3)),P[$++]=H<<2|F>>>4,P[$++]=F<<4|Y>>>2,P[$++]=Y<<6|se,q|=H&u,q|=F&u,q|=Y&u,q|=se&u;if(O<E-1&&(H=this._decodeChar(f.charCodeAt(O)),F=this._decodeChar(f.charCodeAt(O+1)),P[$++]=H<<2|F>>>4,q|=H&u,q|=F&u),O<E-2&&(Y=this._decodeChar(f.charCodeAt(O+2)),P[$++]=F<<4|Y>>>2,q|=Y&u),O<E-3&&(se=this._decodeChar(f.charCodeAt(O+3)),P[$++]=Y<<6|se,q|=se&u),q!==0)throw new Error("Base64Coder: incorrect characters for decoding");return P},w.prototype._encodeByte=function(f){var _=f;return _+=65,_+=25-f>>>8&6,_+=51-f>>>8&-75,_+=61-f>>>8&-15,_+=62-f>>>8&3,String.fromCharCode(_)},w.prototype._decodeChar=function(f){var _=u;return _+=(42-f&f-44)>>>8&-256+f-43+62,_+=(46-f&f-48)>>>8&-256+f-47+63,_+=(47-f&f-58)>>>8&-256+f-48+52,_+=(64-f&f-91)>>>8&-256+f-65+0,_+=(96-f&f-123)>>>8&-256+f-97+26,_},w.prototype._getPaddingLength=function(f){var _=0;if(this._paddingCharacter){for(var E=f.length-1;E>=0&&f[E]===this._paddingCharacter;E--)_++;if(f.length<4||_>2)throw new Error("Base64Coder: incorrect padding")}return _},w}();n.Coder=d;var g=new d;function b(w){return g.encode(w)}n.encode=b;function y(w){return g.decode(w)}n.decode=y;var v=function(w){c(f,w);function f(){return w!==null&&w.apply(this,arguments)||this}return f.prototype._encodeByte=function(_){var E=_;return E+=65,E+=25-_>>>8&6,E+=51-_>>>8&-75,E+=61-_>>>8&-13,E+=62-_>>>8&49,String.fromCharCode(E)},f.prototype._decodeChar=function(_){var E=u;return E+=(44-_&_-46)>>>8&-256+_-45+62,E+=(94-_&_-96)>>>8&-256+_-95+63,E+=(47-_&_-58)>>>8&-256+_-48+52,E+=(64-_&_-91)>>>8&-256+_-65+0,E+=(96-_&_-123)>>>8&-256+_-97+26,E},f}(d);n.URLSafeCoder=v;var C=new v;function x(w){return C.encode(w)}n.encodeURLSafe=x;function k(w){return C.decode(w)}n.decodeURLSafe=k,n.encodedLength=function(w){return g.encodedLength(w)},n.maxDecodedLength=function(w){return g.maxDecodedLength(w)},n.decodedLength=function(w){return g.decodedLength(w)}},function(t,n,o){Object.defineProperty(n,"__esModule",{value:!0});var c="utf8: invalid string",u="utf8: invalid source encoding";function d(y){for(var v=new Uint8Array(g(y)),C=0,x=0;x<y.length;x++){var k=y.charCodeAt(x);k<128?v[C++]=k:k<2048?(v[C++]=192|k>>6,v[C++]=128|k&63):k<55296?(v[C++]=224|k>>12,v[C++]=128|k>>6&63,v[C++]=128|k&63):(x++,k=(k&1023)<<10,k|=y.charCodeAt(x)&1023,k+=65536,v[C++]=240|k>>18,v[C++]=128|k>>12&63,v[C++]=128|k>>6&63,v[C++]=128|k&63)}return v}n.encode=d;function g(y){for(var v=0,C=0;C<y.length;C++){var x=y.charCodeAt(C);if(x<128)v+=1;else if(x<2048)v+=2;else if(x<55296)v+=3;else if(x<=57343){if(C>=y.length-1)throw new Error(c);C++,v+=4}else throw new Error(c)}return v}n.encodedLength=g;function b(y){for(var v=[],C=0;C<y.length;C++){var x=y[C];if(x&128){var k=void 0;if(x<224){if(C>=y.length)throw new Error(u);var w=y[++C];if((w&192)!==128)throw new Error(u);x=(x&31)<<6|w&63,k=128}else if(x<240){if(C>=y.length-1)throw new Error(u);var w=y[++C],f=y[++C];if((w&192)!==128||(f&192)!==128)throw new Error(u);x=(x&15)<<12|(w&63)<<6|f&63,k=2048}else if(x<248){if(C>=y.length-2)throw new Error(u);var w=y[++C],f=y[++C],_=y[++C];if((w&192)!==128||(f&192)!==128||(_&192)!==128)throw new Error(u);x=(x&15)<<18|(w&63)<<12|(f&63)<<6|_&63,k=65536}else throw new Error(u);if(x<k||x>=55296&&x<=57343)throw new Error(u);if(x>=65536){if(x>1114111)throw new Error(u);x-=65536,v.push(String.fromCharCode(55296|x>>10)),x=56320|x&1023}}v.push(String.fromCharCode(x))}return v.join("")}n.decode=b},function(t,n,o){t.exports=o(3).default},function(t,n,o){o.r(n);class c{constructor(r,i){this.lastId=0,this.prefix=r,this.name=i}create(r){this.lastId++;var i=this.lastId,l=this.prefix+i,h=this.name+"["+i+"]",m=!1,S=function(){m||(r.apply(null,arguments),m=!0)};return this[i]=S,{number:i,id:l,name:h,callback:S}}remove(r){delete this[r.number]}}var u=new c("_pusher_script_","Pusher.ScriptReceivers"),d={VERSION:"8.4.0",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""},g=d;class b{constructor(r){this.options=r,this.receivers=r.receivers||u,this.loading={}}load(r,i,l){var h=this;if(h.loading[r]&&h.loading[r].length>0)h.loading[r].push(l);else{h.loading[r]=[l];var m=A.createScriptRequest(h.getPath(r,i)),S=h.receivers.create(function(T){if(h.receivers.remove(S),h.loading[r]){var M=h.loading[r];delete h.loading[r];for(var L=function(D){D||m.cleanup()},I=0;I<M.length;I++)M[I](T,L)}});m.send(S)}}getRoot(r){var i,l=A.getDocument().location.protocol;return r&&r.useTLS||l==="https:"?i=this.options.cdn_https:i=this.options.cdn_http,i.replace(/\/*$/,"")+"/"+this.options.version}getPath(r,i){return this.getRoot(i)+"/"+r+this.options.suffix+".js"}}var y=new c("_pusher_dependencies","Pusher.DependenciesReceivers"),v=new b({cdn_http:g.cdn_http,cdn_https:g.cdn_https,version:g.VERSION,suffix:g.dependency_suffix,receivers:y});const C={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};var k={buildLogSuffix:function(a){const r="See:",i=C.urls[a];if(!i)return"";let l;return i.fullUrl?l=i.fullUrl:i.path&&(l=C.baseUrl+i.path),l?`${r} ${l}`:""}},w;(function(a){a.UserAuthentication="user-authentication",a.ChannelAuthorization="channel-authorization"})(w||(w={}));class f extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class _ extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class E extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class P extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class $ extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class O extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class q extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class H extends Error{constructor(r){super(r),Object.setPrototypeOf(this,new.target.prototype)}}class F extends Error{constructor(r,i){super(i),this.status=r,Object.setPrototypeOf(this,new.target.prototype)}}var se=function(a,r,i,l,h){const m=A.createXHR();m.open("POST",i.endpoint,!0),m.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var S in i.headers)m.setRequestHeader(S,i.headers[S]);if(i.headersProvider!=null){let T=i.headersProvider();for(var S in T)m.setRequestHeader(S,T[S])}return m.onreadystatechange=function(){if(m.readyState===4)if(m.status===200){let T,M=!1;try{T=JSON.parse(m.responseText),M=!0}catch{h(new F(200,`JSON returned from ${l.toString()} endpoint was invalid, yet status code was 200. Data was: ${m.responseText}`),null)}M&&h(null,T)}else{let T="";switch(l){case w.UserAuthentication:T=k.buildLogSuffix("authenticationEndpoint");break;case w.ChannelAuthorization:T=`Clients must be authorized to join private or presence channels. ${k.buildLogSuffix("authorizationEndpoint")}`;break}h(new F(m.status,`Unable to retrieve auth string from ${l.toString()} endpoint - received status: ${m.status} from ${i.endpoint}. ${T}`),null)}},m.send(r),m};function Xn(a){return Kn(Gn(a))}var me=String.fromCharCode,Ee="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Jn=function(a){var r=a.charCodeAt(0);return r<128?a:r<2048?me(192|r>>>6)+me(128|r&63):me(224|r>>>12&15)+me(128|r>>>6&63)+me(128|r&63)},Gn=function(a){return a.replace(/[^\x00-\x7F]/g,Jn)},Vn=function(a){var r=[0,2,1][a.length%3],i=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0),l=[Ee.charAt(i>>>18),Ee.charAt(i>>>12&63),r>=2?"=":Ee.charAt(i>>>6&63),r>=1?"=":Ee.charAt(i&63)];return l.join("")},Kn=window.btoa||function(a){return a.replace(/[\s\S]{1,3}/g,Vn)};class Qn{constructor(r,i,l,h){this.clear=i,this.timer=r(()=>{this.timer&&(this.timer=h(this.timer))},l)}isRunning(){return this.timer!==null}ensureAborted(){this.timer&&(this.clear(this.timer),this.timer=null)}}var kt=Qn;function Yn(a){window.clearTimeout(a)}function Zn(a){window.clearInterval(a)}class ie extends kt{constructor(r,i){super(setTimeout,Yn,r,function(l){return i(),null})}}class er extends kt{constructor(r,i){super(setInterval,Zn,r,function(l){return i(),l})}}var tr={now(){return Date.now?Date.now():new Date().valueOf()},defer(a){return new ie(0,a)},method(a,...r){var i=Array.prototype.slice.call(arguments,1);return function(l){return l[a].apply(l,i.concat(arguments))}}},W=tr;function J(a,...r){for(var i=0;i<r.length;i++){var l=r[i];for(var h in l)l[h]&&l[h].constructor&&l[h].constructor===Object?a[h]=J(a[h]||{},l[h]):a[h]=l[h]}return a}function nr(){for(var a=["Pusher"],r=0;r<arguments.length;r++)typeof arguments[r]=="string"?a.push(arguments[r]):a.push(Te(arguments[r]));return a.join(" : ")}function St(a,r){var i=Array.prototype.indexOf;if(a===null)return-1;if(i&&a.indexOf===i)return a.indexOf(r);for(var l=0,h=a.length;l<h;l++)if(a[l]===r)return l;return-1}function te(a,r){for(var i in a)Object.prototype.hasOwnProperty.call(a,i)&&r(a[i],i,a)}function Ct(a){var r=[];return te(a,function(i,l){r.push(l)}),r}function rr(a){var r=[];return te(a,function(i){r.push(i)}),r}function ge(a,r,i){for(var l=0;l<a.length;l++)r.call(i||window,a[l],l,a)}function Et(a,r){for(var i=[],l=0;l<a.length;l++)i.push(r(a[l],l,a,i));return i}function sr(a,r){var i={};return te(a,function(l,h){i[h]=r(l)}),i}function Tt(a,r){r=r||function(h){return!!h};for(var i=[],l=0;l<a.length;l++)r(a[l],l,a,i)&&i.push(a[l]);return i}function xt(a,r){var i={};return te(a,function(l,h){(r&&r(l,h,a,i)||l)&&(i[h]=l)}),i}function ir(a){var r=[];return te(a,function(i,l){r.push([l,i])}),r}function Pt(a,r){for(var i=0;i<a.length;i++)if(r(a[i],i,a))return!0;return!1}function or(a,r){for(var i=0;i<a.length;i++)if(!r(a[i],i,a))return!1;return!0}function ar(a){return sr(a,function(r){return typeof r=="object"&&(r=Te(r)),encodeURIComponent(Xn(r.toString()))})}function cr(a){var r=xt(a,function(l){return l!==void 0}),i=Et(ir(ar(r)),W.method("join","=")).join("&");return i}function lr(a){var r=[],i=[];return function l(h,m){var S,T,M;switch(typeof h){case"object":if(!h)return null;for(S=0;S<r.length;S+=1)if(r[S]===h)return{$ref:i[S]};if(r.push(h),i.push(m),Object.prototype.toString.apply(h)==="[object Array]")for(M=[],S=0;S<h.length;S+=1)M[S]=l(h[S],m+"["+S+"]");else{M={};for(T in h)Object.prototype.hasOwnProperty.call(h,T)&&(M[T]=l(h[T],m+"["+JSON.stringify(T)+"]"))}return M;case"number":case"string":case"boolean":return h}}(a,"$")}function Te(a){try{return JSON.stringify(a)}catch{return JSON.stringify(lr(a))}}class ur{constructor(){this.globalLog=r=>{window.console&&window.console.log&&window.console.log(r)}}debug(...r){this.log(this.globalLog,r)}warn(...r){this.log(this.globalLogWarn,r)}error(...r){this.log(this.globalLogError,r)}globalLogWarn(r){window.console&&window.console.warn?window.console.warn(r):this.globalLog(r)}globalLogError(r){window.console&&window.console.error?window.console.error(r):this.globalLogWarn(r)}log(r,...i){var l=nr.apply(this,arguments);tt.log?tt.log(l):tt.logToConsole&&r.bind(this)(l)}}var N=new ur,hr=function(a,r,i,l,h){(i.headers!==void 0||i.headersProvider!=null)&&N.warn(`To send headers with the ${l.toString()} request, you must use AJAX, rather than JSONP.`);var m=a.nextAuthCallbackID.toString();a.nextAuthCallbackID++;var S=a.getDocument(),T=S.createElement("script");a.auth_callbacks[m]=function(I){h(null,I)};var M="Pusher.auth_callbacks['"+m+"']";T.src=i.endpoint+"?callback="+encodeURIComponent(M)+"&"+r;var L=S.getElementsByTagName("head")[0]||S.documentElement;L.insertBefore(T,L.firstChild)},dr=hr;class pr{constructor(r){this.src=r}send(r){var i=this,l="Error loading "+i.src;i.script=document.createElement("script"),i.script.id=r.id,i.script.src=i.src,i.script.type="text/javascript",i.script.charset="UTF-8",i.script.addEventListener?(i.script.onerror=function(){r.callback(l)},i.script.onload=function(){r.callback(null)}):i.script.onreadystatechange=function(){(i.script.readyState==="loaded"||i.script.readyState==="complete")&&r.callback(null)},i.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)?(i.errorScript=document.createElement("script"),i.errorScript.id=r.id+"_error",i.errorScript.text=r.name+"('"+l+"');",i.script.async=i.errorScript.async=!1):i.script.async=!0;var h=document.getElementsByTagName("head")[0];h.insertBefore(i.script,h.firstChild),i.errorScript&&h.insertBefore(i.errorScript,i.script.nextSibling)}cleanup(){this.script&&(this.script.onload=this.script.onerror=null,this.script.onreadystatechange=null),this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script),this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript),this.script=null,this.errorScript=null}}class fr{constructor(r,i){this.url=r,this.data=i}send(r){if(!this.request){var i=cr(this.data),l=this.url+"/"+r.number+"?"+i;this.request=A.createScriptRequest(l),this.request.send(r)}}cleanup(){this.request&&this.request.cleanup()}}var mr=function(a,r){return function(i,l){var h="http"+(r?"s":"")+"://",m=h+(a.host||a.options.host)+a.options.path,S=A.createJSONPRequest(m,i),T=A.ScriptReceivers.create(function(M,L){u.remove(T),S.cleanup(),L&&L.host&&(a.host=L.host),l&&l(M,L)});S.send(T)}},gr={name:"jsonp",getAgent:mr},yr=gr;function We(a,r,i){var l=a+(r.useTLS?"s":""),h=r.useTLS?r.hostTLS:r.hostNonTLS;return l+"://"+h+i}function Xe(a,r){var i="/app/"+a,l="?protocol="+g.PROTOCOL+"&client=js&version="+g.VERSION+(r?"&"+r:"");return i+l}var br={getInitial:function(a,r){var i=(r.httpPath||"")+Xe(a,"flash=false");return We("ws",r,i)}},vr={getInitial:function(a,r){var i=(r.httpPath||"/pusher")+Xe(a);return We("http",r,i)}},wr={getInitial:function(a,r){return We("http",r,r.httpPath||"/pusher")},getPath:function(a,r){return Xe(a)}};class _r{constructor(){this._callbacks={}}get(r){return this._callbacks[Je(r)]}add(r,i,l){var h=Je(r);this._callbacks[h]=this._callbacks[h]||[],this._callbacks[h].push({fn:i,context:l})}remove(r,i,l){if(!r&&!i&&!l){this._callbacks={};return}var h=r?[Je(r)]:Ct(this._callbacks);i||l?this.removeCallback(h,i,l):this.removeAllCallbacks(h)}removeCallback(r,i,l){ge(r,function(h){this._callbacks[h]=Tt(this._callbacks[h]||[],function(m){return i&&i!==m.fn||l&&l!==m.context}),this._callbacks[h].length===0&&delete this._callbacks[h]},this)}removeAllCallbacks(r){ge(r,function(i){delete this._callbacks[i]},this)}}function Je(a){return"_"+a}class ne{constructor(r){this.callbacks=new _r,this.global_callbacks=[],this.failThrough=r}bind(r,i,l){return this.callbacks.add(r,i,l),this}bind_global(r){return this.global_callbacks.push(r),this}unbind(r,i,l){return this.callbacks.remove(r,i,l),this}unbind_global(r){return r?(this.global_callbacks=Tt(this.global_callbacks||[],i=>i!==r),this):(this.global_callbacks=[],this)}unbind_all(){return this.unbind(),this.unbind_global(),this}emit(r,i,l){for(var h=0;h<this.global_callbacks.length;h++)this.global_callbacks[h](r,i);var m=this.callbacks.get(r),S=[];if(l?S.push(i,l):i&&S.push(i),m&&m.length>0)for(var h=0;h<m.length;h++)m[h].fn.apply(m[h].context||window,S);else this.failThrough&&this.failThrough(r,i);return this}}class kr extends ne{constructor(r,i,l,h,m){super(),this.initialize=A.transportConnectionInitializer,this.hooks=r,this.name=i,this.priority=l,this.key=h,this.options=m,this.state="new",this.timeline=m.timeline,this.activityTimeout=m.activityTimeout,this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return!!this.hooks.handlesActivityChecks}supportsPing(){return!!this.hooks.supportsPing}connect(){if(this.socket||this.state!=="initialized")return!1;var r=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(r,this.options)}catch(i){return W.defer(()=>{this.onError(i),this.changeState("closed")}),!1}return this.bindListeners(),N.debug("Connecting",{transport:this.name,url:r}),this.changeState("connecting"),!0}close(){return this.socket?(this.socket.close(),!0):!1}send(r){return this.state==="open"?(W.defer(()=>{this.socket&&this.socket.send(r)}),!0):!1}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options)),this.changeState("open"),this.socket.onopen=void 0}onError(r){this.emit("error",{type:"WebSocketError",error:r}),this.timeline.error(this.buildTimelineMessage({error:r.toString()}))}onClose(r){r?this.changeState("closed",{code:r.code,reason:r.reason,wasClean:r.wasClean}):this.changeState("closed"),this.unbindListeners(),this.socket=void 0}onMessage(r){this.emit("message",r)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()},this.socket.onerror=r=>{this.onError(r)},this.socket.onclose=r=>{this.onClose(r)},this.socket.onmessage=r=>{this.onMessage(r)},this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){this.socket&&(this.socket.onopen=void 0,this.socket.onerror=void 0,this.socket.onclose=void 0,this.socket.onmessage=void 0,this.supportsPing()&&(this.socket.onactivity=void 0))}changeState(r,i){this.state=r,this.timeline.info(this.buildTimelineMessage({state:r,params:i})),this.emit(r,i)}buildTimelineMessage(r){return J({cid:this.id},r)}}class de{constructor(r){this.hooks=r}isSupported(r){return this.hooks.isSupported(r)}createConnection(r,i,l,h){return new kr(this.hooks,r,i,l,h)}}var Sr=new de({urls:br,handlesActivityChecks:!1,supportsPing:!1,isInitialized:function(){return!!A.getWebSocketAPI()},isSupported:function(){return!!A.getWebSocketAPI()},getSocket:function(a){return A.createWebSocket(a)}}),Mt={urls:vr,handlesActivityChecks:!1,supportsPing:!0,isInitialized:function(){return!0}},At=J({getSocket:function(a){return A.HTTPFactory.createStreamingSocket(a)}},Mt),Rt=J({getSocket:function(a){return A.HTTPFactory.createPollingSocket(a)}},Mt),Lt={isSupported:function(){return A.isXHRSupported()}},Cr=new de(J({},At,Lt)),Er=new de(J({},Rt,Lt)),Tr={ws:Sr,xhr_streaming:Cr,xhr_polling:Er},xe=Tr,xr=new de({file:"sockjs",urls:wr,handlesActivityChecks:!0,supportsPing:!1,isSupported:function(){return!0},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(a,r){return new window.SockJS(a,null,{js_path:v.getPath("sockjs",{useTLS:r.useTLS}),ignore_null_origin:r.ignoreNullOrigin})},beforeOpen:function(a,r){a.send(JSON.stringify({path:r}))}}),Ot={isSupported:function(a){var r=A.isXDRSupported(a.useTLS);return r}},Pr=new de(J({},At,Ot)),Mr=new de(J({},Rt,Ot));xe.xdr_streaming=Pr,xe.xdr_polling=Mr,xe.sockjs=xr;var Ar=xe;class Rr extends ne{constructor(){super();var r=this;window.addEventListener!==void 0&&(window.addEventListener("online",function(){r.emit("online")},!1),window.addEventListener("offline",function(){r.emit("offline")},!1))}isOnline(){return window.navigator.onLine===void 0?!0:window.navigator.onLine}}var Lr=new Rr;class Or{constructor(r,i,l){this.manager=r,this.transport=i,this.minPingDelay=l.minPingDelay,this.maxPingDelay=l.maxPingDelay,this.pingDelay=void 0}createConnection(r,i,l,h){h=J({},h,{activityTimeout:this.pingDelay});var m=this.transport.createConnection(r,i,l,h),S=null,T=function(){m.unbind("open",T),m.bind("closed",M),S=W.now()},M=L=>{if(m.unbind("closed",M),L.code===1002||L.code===1003)this.manager.reportDeath();else if(!L.wasClean&&S){var I=W.now()-S;I<2*this.maxPingDelay&&(this.manager.reportDeath(),this.pingDelay=Math.max(I/2,this.minPingDelay))}};return m.bind("open",T),m}isSupported(r){return this.manager.isAlive()&&this.transport.isSupported(r)}}const It={decodeMessage:function(a){try{var r=JSON.parse(a.data),i=r.data;if(typeof i=="string")try{i=JSON.parse(r.data)}catch{}var l={event:r.event,channel:r.channel,data:i};return r.user_id&&(l.user_id=r.user_id),l}catch(h){throw{type:"MessageParseError",error:h,data:a.data}}},encodeMessage:function(a){return JSON.stringify(a)},processHandshake:function(a){var r=It.decodeMessage(a);if(r.event==="pusher:connection_established"){if(!r.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:r.data.socket_id,activityTimeout:r.data.activity_timeout*1e3}}else{if(r.event==="pusher:error")return{action:this.getCloseAction(r.data),error:this.getCloseError(r.data)};throw"Invalid handshake"}},getCloseAction:function(a){return a.code<4e3?a.code>=1002&&a.code<=1004?"backoff":null:a.code===4e3?"tls_only":a.code<4100?"refused":a.code<4200?"backoff":a.code<4300?"retry":"refused"},getCloseError:function(a){return a.code!==1e3&&a.code!==1001?{type:"PusherError",data:{code:a.code,message:a.reason||a.message}}:null}};var oe=It;class Ir extends ne{constructor(r,i){super(),this.id=r,this.transport=i,this.activityTimeout=i.activityTimeout,this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(r){return this.transport.send(r)}send_event(r,i,l){var h={event:r,data:i};return l&&(h.channel=l),N.debug("Event sent",h),this.send(oe.encodeMessage(h))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var r={message:l=>{var h;try{h=oe.decodeMessage(l)}catch(m){this.emit("error",{type:"MessageParseError",error:m,data:l.data})}if(h!==void 0){switch(N.debug("Event recd",h),h.event){case"pusher:error":this.emit("error",{type:"PusherError",data:h.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",h)}},activity:()=>{this.emit("activity")},error:l=>{this.emit("error",l)},closed:l=>{i(),l&&l.code&&this.handleCloseEvent(l),this.transport=null,this.emit("closed")}},i=()=>{te(r,(l,h)=>{this.transport.unbind(h,l)})};te(r,(l,h)=>{this.transport.bind(h,l)})}handleCloseEvent(r){var i=oe.getCloseAction(r),l=oe.getCloseError(r);l&&this.emit("error",l),i&&this.emit(i,{action:i,error:l})}}class $r{constructor(r,i){this.transport=r,this.callback=i,this.bindListeners()}close(){this.unbindListeners(),this.transport.close()}bindListeners(){this.onMessage=r=>{this.unbindListeners();var i;try{i=oe.processHandshake(r)}catch(l){this.finish("error",{error:l}),this.transport.close();return}i.action==="connected"?this.finish("connected",{connection:new Ir(i.id,this.transport),activityTimeout:i.activityTimeout}):(this.finish(i.action,{error:i.error}),this.transport.close())},this.onClosed=r=>{this.unbindListeners();var i=oe.getCloseAction(r)||"backoff",l=oe.getCloseError(r);this.finish(i,{error:l})},this.transport.bind("message",this.onMessage),this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage),this.transport.unbind("closed",this.onClosed)}finish(r,i){this.callback(J({transport:this.transport,action:r},i))}}class Nr{constructor(r,i){this.timeline=r,this.options=i||{}}send(r,i){this.timeline.isEmpty()||this.timeline.send(A.TimelineTransport.getAgent(this,r),i)}}class Ge extends ne{constructor(r,i){super(function(l,h){N.debug("No callbacks on "+r+" for "+l)}),this.name=r,this.pusher=i,this.subscribed=!1,this.subscriptionPending=!1,this.subscriptionCancelled=!1}authorize(r,i){return i(null,{auth:""})}trigger(r,i){if(r.indexOf("client-")!==0)throw new f("Event '"+r+"' does not start with 'client-'");if(!this.subscribed){var l=k.buildLogSuffix("triggeringClientEvents");N.warn(`Client event triggered before channel 'subscription_succeeded' event . ${l}`)}return this.pusher.send_event(r,i,this.name)}disconnect(){this.subscribed=!1,this.subscriptionPending=!1}handleEvent(r){var i=r.event,l=r.data;if(i==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(r);else if(i==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(r);else if(i.indexOf("pusher_internal:")!==0){var h={};this.emit(i,l,h)}}handleSubscriptionSucceededEvent(r){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",r.data)}handleSubscriptionCountEvent(r){r.data.subscription_count&&(this.subscriptionCount=r.data.subscription_count),this.emit("pusher:subscription_count",r.data)}subscribe(){this.subscribed||(this.subscriptionPending=!0,this.subscriptionCancelled=!1,this.authorize(this.pusher.connection.socket_id,(r,i)=>{r?(this.subscriptionPending=!1,N.error(r.toString()),this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:r.message},r instanceof F?{status:r.status}:{}))):this.pusher.send_event("pusher:subscribe",{auth:i.auth,channel_data:i.channel_data,channel:this.name})}))}unsubscribe(){this.subscribed=!1,this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=!0}reinstateSubscription(){this.subscriptionCancelled=!1}}class Ve extends Ge{authorize(r,i){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:r},i)}}class jr{constructor(){this.reset()}get(r){return Object.prototype.hasOwnProperty.call(this.members,r)?{id:r,info:this.members[r]}:null}each(r){te(this.members,(i,l)=>{r(this.get(l))})}setMyID(r){this.myID=r}onSubscription(r){this.members=r.presence.hash,this.count=r.presence.count,this.me=this.get(this.myID)}addMember(r){return this.get(r.user_id)===null&&this.count++,this.members[r.user_id]=r.user_info,this.get(r.user_id)}removeMember(r){var i=this.get(r.user_id);return i&&(delete this.members[r.user_id],this.count--),i}reset(){this.members={},this.count=0,this.myID=null,this.me=null}}var qr=function(a,r,i,l){function h(m){return m instanceof i?m:new i(function(S){S(m)})}return new(i||(i=Promise))(function(m,S){function T(I){try{L(l.next(I))}catch(D){S(D)}}function M(I){try{L(l.throw(I))}catch(D){S(D)}}function L(I){I.done?m(I.value):h(I.value).then(T,M)}L((l=l.apply(a,r||[])).next())})};class Dr extends Ve{constructor(r,i){super(r,i),this.members=new jr}authorize(r,i){super.authorize(r,(l,h)=>qr(this,void 0,void 0,function*(){if(!l)if(h=h,h.channel_data!=null){var m=JSON.parse(h.channel_data);this.members.setMyID(m.user_id)}else if(yield this.pusher.user.signinDonePromise,this.pusher.user.user_data!=null)this.members.setMyID(this.pusher.user.user_data.id);else{let S=k.buildLogSuffix("authorizationEndpoint");N.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${S}, or the user should be signed in.`),i("Invalid auth response");return}i(l,h)}))}handleEvent(r){var i=r.event;if(i.indexOf("pusher_internal:")===0)this.handleInternalEvent(r);else{var l=r.data,h={};r.user_id&&(h.user_id=r.user_id),this.emit(i,l,h)}}handleInternalEvent(r){var i=r.event,l=r.data;switch(i){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(r);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(r);break;case"pusher_internal:member_added":var h=this.members.addMember(l);this.emit("pusher:member_added",h);break;case"pusher_internal:member_removed":var m=this.members.removeMember(l);m&&this.emit("pusher:member_removed",m);break}}handleSubscriptionSucceededEvent(r){this.subscriptionPending=!1,this.subscribed=!0,this.subscriptionCancelled?this.pusher.unsubscribe(this.name):(this.members.onSubscription(r.data),this.emit("pusher:subscription_succeeded",this.members))}disconnect(){this.members.reset(),super.disconnect()}}var Br=o(1),Ke=o(0);class Ur extends Ve{constructor(r,i,l){super(r,i),this.key=null,this.nacl=l}authorize(r,i){super.authorize(r,(l,h)=>{if(l){i(l,h);return}let m=h.shared_secret;if(!m){i(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null);return}this.key=Object(Ke.decode)(m),delete h.shared_secret,i(null,h)})}trigger(r,i){throw new O("Client events are not currently supported for encrypted channels")}handleEvent(r){var i=r.event,l=r.data;if(i.indexOf("pusher_internal:")===0||i.indexOf("pusher:")===0){super.handleEvent(r);return}this.handleEncryptedEvent(i,l)}handleEncryptedEvent(r,i){if(!this.key){N.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!i.ciphertext||!i.nonce){N.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+i);return}let l=Object(Ke.decode)(i.ciphertext);if(l.length<this.nacl.secretbox.overheadLength){N.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${l.length}`);return}let h=Object(Ke.decode)(i.nonce);if(h.length<this.nacl.secretbox.nonceLength){N.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${h.length}`);return}let m=this.nacl.secretbox.open(l,h,this.key);if(m===null){N.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint..."),this.authorize(this.pusher.connection.socket_id,(S,T)=>{if(S){N.error(`Failed to make a request to the authEndpoint: ${T}. Unable to fetch new key, so dropping encrypted event`);return}if(m=this.nacl.secretbox.open(l,h,this.key),m===null){N.error("Failed to decrypt event with new key. Dropping encrypted event");return}this.emit(r,this.getDataToEmit(m))});return}this.emit(r,this.getDataToEmit(m))}getDataToEmit(r){let i=Object(Br.decode)(r);try{return JSON.parse(i)}catch{return i}}}class Hr extends ne{constructor(r,i){super(),this.state="initialized",this.connection=null,this.key=r,this.options=i,this.timeline=this.options.timeline,this.usingTLS=this.options.useTLS,this.errorCallbacks=this.buildErrorCallbacks(),this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks),this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var l=A.getNetwork();l.bind("online",()=>{this.timeline.info({netinfo:"online"}),(this.state==="connecting"||this.state==="unavailable")&&this.retryIn(0)}),l.bind("offline",()=>{this.timeline.info({netinfo:"offline"}),this.connection&&this.sendActivityCheck()}),this.updateStrategy()}connect(){if(!(this.connection||this.runner)){if(!this.strategy.isSupported()){this.updateState("failed");return}this.updateState("connecting"),this.startConnecting(),this.setUnavailableTimer()}}send(r){return this.connection?this.connection.send(r):!1}send_event(r,i,l){return this.connection?this.connection.send_event(r,i,l):!1}disconnect(){this.disconnectInternally(),this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var r=(i,l)=>{i?this.runner=this.strategy.connect(0,r):l.action==="error"?(this.emit("error",{type:"HandshakeError",error:l.error}),this.timeline.error({handshakeError:l.error})):(this.abortConnecting(),this.handshakeCallbacks[l.action](l))};this.runner=this.strategy.connect(0,r)}abortConnecting(){this.runner&&(this.runner.abort(),this.runner=null)}disconnectInternally(){if(this.abortConnecting(),this.clearRetryTimer(),this.clearUnavailableTimer(),this.connection){var r=this.abandonConnection();r.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(r){this.timeline.info({action:"retry",delay:r}),r>0&&this.emit("connecting_in",Math.round(r/1e3)),this.retryTimer=new ie(r||0,()=>{this.disconnectInternally(),this.connect()})}clearRetryTimer(){this.retryTimer&&(this.retryTimer.ensureAborted(),this.retryTimer=null)}setUnavailableTimer(){this.unavailableTimer=new ie(this.options.unavailableTimeout,()=>{this.updateState("unavailable")})}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck(),this.connection.ping(),this.activityTimer=new ie(this.options.pongTimeout,()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout}),this.retryIn(0)})}resetActivityCheck(){this.stopActivityCheck(),this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new ie(this.activityTimeout,()=>{this.sendActivityCheck()}))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(r){return J({},r,{message:i=>{this.resetActivityCheck(),this.emit("message",i)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:i=>{this.emit("error",i)},closed:()=>{this.abandonConnection(),this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(r){return J({},r,{connected:i=>{this.activityTimeout=Math.min(this.options.activityTimeout,i.activityTimeout,i.connection.activityTimeout||1/0),this.clearUnavailableTimer(),this.setConnection(i.connection),this.socket_id=this.connection.id,this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let r=i=>l=>{l.error&&this.emit("error",{type:"WebSocketError",error:l.error}),i(l)};return{tls_only:r(()=>{this.usingTLS=!0,this.updateStrategy(),this.retryIn(0)}),refused:r(()=>{this.disconnect()}),backoff:r(()=>{this.retryIn(1e3)}),retry:r(()=>{this.retryIn(0)})}}setConnection(r){this.connection=r;for(var i in this.connectionCallbacks)this.connection.bind(i,this.connectionCallbacks[i]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var r in this.connectionCallbacks)this.connection.unbind(r,this.connectionCallbacks[r]);var i=this.connection;return this.connection=null,i}}updateState(r,i){var l=this.state;if(this.state=r,l!==r){var h=r;h==="connected"&&(h+=" with new socket ID "+i.socket_id),N.debug("State changed",l+" -> "+h),this.timeline.info({state:r,params:i}),this.emit("state_change",{previous:l,current:r}),this.emit(r,i)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class Fr{constructor(){this.channels={}}add(r,i){return this.channels[r]||(this.channels[r]=zr(r,i)),this.channels[r]}all(){return rr(this.channels)}find(r){return this.channels[r]}remove(r){var i=this.channels[r];return delete this.channels[r],i}disconnect(){te(this.channels,function(r){r.disconnect()})}}function zr(a,r){if(a.indexOf("private-encrypted-")===0){if(r.config.nacl)return re.createEncryptedChannel(a,r,r.config.nacl);let i="Tried to subscribe to a private-encrypted- channel but no nacl implementation available",l=k.buildLogSuffix("encryptedChannelSupport");throw new O(`${i}. ${l}`)}else{if(a.indexOf("private-")===0)return re.createPrivateChannel(a,r);if(a.indexOf("presence-")===0)return re.createPresenceChannel(a,r);if(a.indexOf("#")===0)throw new _('Cannot create a channel with name "'+a+'".');return re.createChannel(a,r)}}var Wr={createChannels(){return new Fr},createConnectionManager(a,r){return new Hr(a,r)},createChannel(a,r){return new Ge(a,r)},createPrivateChannel(a,r){return new Ve(a,r)},createPresenceChannel(a,r){return new Dr(a,r)},createEncryptedChannel(a,r,i){return new Ur(a,r,i)},createTimelineSender(a,r){return new Nr(a,r)},createHandshake(a,r){return new $r(a,r)},createAssistantToTheTransportManager(a,r,i){return new Or(a,r,i)}},re=Wr;class $t{constructor(r){this.options=r||{},this.livesLeft=this.options.lives||1/0}getAssistant(r){return re.createAssistantToTheTransportManager(this,r,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class ae{constructor(r,i){this.strategies=r,this.loop=!!i.loop,this.failFast=!!i.failFast,this.timeout=i.timeout,this.timeoutLimit=i.timeoutLimit}isSupported(){return Pt(this.strategies,W.method("isSupported"))}connect(r,i){var l=this.strategies,h=0,m=this.timeout,S=null,T=(M,L)=>{L?i(null,L):(h=h+1,this.loop&&(h=h%l.length),h<l.length?(m&&(m=m*2,this.timeoutLimit&&(m=Math.min(m,this.timeoutLimit))),S=this.tryStrategy(l[h],r,{timeout:m,failFast:this.failFast},T)):i(!0))};return S=this.tryStrategy(l[h],r,{timeout:m,failFast:this.failFast},T),{abort:function(){S.abort()},forceMinPriority:function(M){r=M,S&&S.forceMinPriority(M)}}}tryStrategy(r,i,l,h){var m=null,S=null;return l.timeout>0&&(m=new ie(l.timeout,function(){S.abort(),h(!0)})),S=r.connect(i,function(T,M){T&&m&&m.isRunning()&&!l.failFast||(m&&m.ensureAborted(),h(T,M))}),{abort:function(){m&&m.ensureAborted(),S.abort()},forceMinPriority:function(T){S.forceMinPriority(T)}}}}class Qe{constructor(r){this.strategies=r}isSupported(){return Pt(this.strategies,W.method("isSupported"))}connect(r,i){return Xr(this.strategies,r,function(l,h){return function(m,S){if(h[l].error=m,m){Jr(h)&&i(!0);return}ge(h,function(T){T.forceMinPriority(S.transport.priority)}),i(null,S)}})}}function Xr(a,r,i){var l=Et(a,function(h,m,S,T){return h.connect(r,i(m,T))});return{abort:function(){ge(l,Gr)},forceMinPriority:function(h){ge(l,function(m){m.forceMinPriority(h)})}}}function Jr(a){return or(a,function(r){return!!r.error})}function Gr(a){!a.error&&!a.aborted&&(a.abort(),a.aborted=!0)}class Vr{constructor(r,i,l){this.strategy=r,this.transports=i,this.ttl=l.ttl||1800*1e3,this.usingTLS=l.useTLS,this.timeline=l.timeline}isSupported(){return this.strategy.isSupported()}connect(r,i){var l=this.usingTLS,h=Kr(l),m=h&&h.cacheSkipCount?h.cacheSkipCount:0,S=[this.strategy];if(h&&h.timestamp+this.ttl>=W.now()){var T=this.transports[h.transport];T&&(["ws","wss"].includes(h.transport)||m>3?(this.timeline.info({cached:!0,transport:h.transport,latency:h.latency}),S.push(new ae([T],{timeout:h.latency*2+1e3,failFast:!0}))):m++)}var M=W.now(),L=S.pop().connect(r,function I(D,Ae){D?(Nt(l),S.length>0?(M=W.now(),L=S.pop().connect(r,I)):i(D)):(Qr(l,Ae.transport.name,W.now()-M,m),i(null,Ae))});return{abort:function(){L.abort()},forceMinPriority:function(I){r=I,L&&L.forceMinPriority(I)}}}}function Ye(a){return"pusherTransport"+(a?"TLS":"NonTLS")}function Kr(a){var r=A.getLocalStorage();if(r)try{var i=r[Ye(a)];if(i)return JSON.parse(i)}catch{Nt(a)}return null}function Qr(a,r,i,l){var h=A.getLocalStorage();if(h)try{h[Ye(a)]=Te({timestamp:W.now(),transport:r,latency:i,cacheSkipCount:l})}catch{}}function Nt(a){var r=A.getLocalStorage();if(r)try{delete r[Ye(a)]}catch{}}class Pe{constructor(r,{delay:i}){this.strategy=r,this.options={delay:i}}isSupported(){return this.strategy.isSupported()}connect(r,i){var l=this.strategy,h,m=new ie(this.options.delay,function(){h=l.connect(r,i)});return{abort:function(){m.ensureAborted(),h&&h.abort()},forceMinPriority:function(S){r=S,h&&h.forceMinPriority(S)}}}}class ye{constructor(r,i,l){this.test=r,this.trueBranch=i,this.falseBranch=l}isSupported(){var r=this.test()?this.trueBranch:this.falseBranch;return r.isSupported()}connect(r,i){var l=this.test()?this.trueBranch:this.falseBranch;return l.connect(r,i)}}class Yr{constructor(r){this.strategy=r}isSupported(){return this.strategy.isSupported()}connect(r,i){var l=this.strategy.connect(r,function(h,m){m&&l.abort(),i(h,m)});return l}}function be(a){return function(){return a.isSupported()}}var Zr=function(a,r,i){var l={};function h(Jt,Ys,Zs,ei,ti){var Gt=i(a,Jt,Ys,Zs,ei,ti);return l[Jt]=Gt,Gt}var m=Object.assign({},r,{hostNonTLS:a.wsHost+":"+a.wsPort,hostTLS:a.wsHost+":"+a.wssPort,httpPath:a.wsPath}),S=Object.assign({},m,{useTLS:!0}),T=Object.assign({},r,{hostNonTLS:a.httpHost+":"+a.httpPort,hostTLS:a.httpHost+":"+a.httpsPort,httpPath:a.httpPath}),M={loop:!0,timeout:15e3,timeoutLimit:6e4},L=new $t({minPingDelay:1e4,maxPingDelay:a.activityTimeout}),I=new $t({lives:2,minPingDelay:1e4,maxPingDelay:a.activityTimeout}),D=h("ws","ws",3,m,L),Ae=h("wss","ws",3,S,L),Js=h("sockjs","sockjs",1,T),Ut=h("xhr_streaming","xhr_streaming",1,T,I),Gs=h("xdr_streaming","xdr_streaming",1,T,I),Ht=h("xhr_polling","xhr_polling",1,T),Vs=h("xdr_polling","xdr_polling",1,T),Ft=new ae([D],M),Ks=new ae([Ae],M),Qs=new ae([Js],M),zt=new ae([new ye(be(Ut),Ut,Gs)],M),Wt=new ae([new ye(be(Ht),Ht,Vs)],M),Xt=new ae([new ye(be(zt),new Qe([zt,new Pe(Wt,{delay:4e3})]),Wt)],M),nt=new ye(be(Xt),Xt,Qs),rt;return r.useTLS?rt=new Qe([Ft,new Pe(nt,{delay:2e3})]):rt=new Qe([Ft,new Pe(Ks,{delay:2e3}),new Pe(nt,{delay:5e3})]),new Vr(new Yr(new ye(be(D),rt,nt)),l,{ttl:18e5,timeline:r.timeline,useTLS:r.useTLS})},es=Zr,ts=function(){var a=this;a.timeline.info(a.buildTimelineMessage({transport:a.name+(a.options.useTLS?"s":"")})),a.hooks.isInitialized()?a.changeState("initialized"):a.hooks.file?(a.changeState("initializing"),v.load(a.hooks.file,{useTLS:a.options.useTLS},function(r,i){a.hooks.isInitialized()?(a.changeState("initialized"),i(!0)):(r&&a.onError(r),a.onClose(),i(!1))})):a.onClose()},ns={getRequest:function(a){var r=new window.XDomainRequest;return r.ontimeout=function(){a.emit("error",new E),a.close()},r.onerror=function(i){a.emit("error",i),a.close()},r.onprogress=function(){r.responseText&&r.responseText.length>0&&a.onChunk(200,r.responseText)},r.onload=function(){r.responseText&&r.responseText.length>0&&a.onChunk(200,r.responseText),a.emit("finished",200),a.close()},r},abortRequest:function(a){a.ontimeout=a.onerror=a.onprogress=a.onload=null,a.abort()}},rs=ns;const ss=256*1024;class is extends ne{constructor(r,i,l){super(),this.hooks=r,this.method=i,this.url=l}start(r){this.position=0,this.xhr=this.hooks.getRequest(this),this.unloader=()=>{this.close()},A.addUnloadListener(this.unloader),this.xhr.open(this.method,this.url,!0),this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json"),this.xhr.send(r)}close(){this.unloader&&(A.removeUnloadListener(this.unloader),this.unloader=null),this.xhr&&(this.hooks.abortRequest(this.xhr),this.xhr=null)}onChunk(r,i){for(;;){var l=this.advanceBuffer(i);if(l)this.emit("chunk",{status:r,data:l});else break}this.isBufferTooLong(i)&&this.emit("buffer_too_long")}advanceBuffer(r){var i=r.slice(this.position),l=i.indexOf(`
`);return l!==-1?(this.position+=l+1,i.slice(0,l)):null}isBufferTooLong(r){return this.position===r.length&&r.length>ss}}var Ze;(function(a){a[a.CONNECTING=0]="CONNECTING",a[a.OPEN=1]="OPEN",a[a.CLOSED=3]="CLOSED"})(Ze||(Ze={}));var ce=Ze,os=1;class as{constructor(r,i){this.hooks=r,this.session=qt(1e3)+"/"+hs(8),this.location=cs(i),this.readyState=ce.CONNECTING,this.openStream()}send(r){return this.sendRaw(JSON.stringify([r]))}ping(){this.hooks.sendHeartbeat(this)}close(r,i){this.onClose(r,i,!0)}sendRaw(r){if(this.readyState===ce.OPEN)try{return A.createSocketRequest("POST",jt(ls(this.location,this.session))).start(r),!0}catch{return!1}else return!1}reconnect(){this.closeStream(),this.openStream()}onClose(r,i,l){this.closeStream(),this.readyState=ce.CLOSED,this.onclose&&this.onclose({code:r,reason:i,wasClean:l})}onChunk(r){if(r.status===200){this.readyState===ce.OPEN&&this.onActivity();var i,l=r.data.slice(0,1);switch(l){case"o":i=JSON.parse(r.data.slice(1)||"{}"),this.onOpen(i);break;case"a":i=JSON.parse(r.data.slice(1)||"[]");for(var h=0;h<i.length;h++)this.onEvent(i[h]);break;case"m":i=JSON.parse(r.data.slice(1)||"null"),this.onEvent(i);break;case"h":this.hooks.onHeartbeat(this);break;case"c":i=JSON.parse(r.data.slice(1)||"[]"),this.onClose(i[0],i[1],!0);break}}}onOpen(r){this.readyState===ce.CONNECTING?(r&&r.hostname&&(this.location.base=us(this.location.base,r.hostname)),this.readyState=ce.OPEN,this.onopen&&this.onopen()):this.onClose(1006,"Server lost session",!0)}onEvent(r){this.readyState===ce.OPEN&&this.onmessage&&this.onmessage({data:r})}onActivity(){this.onactivity&&this.onactivity()}onError(r){this.onerror&&this.onerror(r)}openStream(){this.stream=A.createSocketRequest("POST",jt(this.hooks.getReceiveURL(this.location,this.session))),this.stream.bind("chunk",r=>{this.onChunk(r)}),this.stream.bind("finished",r=>{this.hooks.onFinished(this,r)}),this.stream.bind("buffer_too_long",()=>{this.reconnect()});try{this.stream.start()}catch(r){W.defer(()=>{this.onError(r),this.onClose(1006,"Could not start streaming",!1)})}}closeStream(){this.stream&&(this.stream.unbind_all(),this.stream.close(),this.stream=null)}}function cs(a){var r=/([^\?]*)\/*(\??.*)/.exec(a);return{base:r[1],queryString:r[2]}}function ls(a,r){return a.base+"/"+r+"/xhr_send"}function jt(a){var r=a.indexOf("?")===-1?"?":"&";return a+r+"t="+ +new Date+"&n="+os++}function us(a,r){var i=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(a);return i[1]+r+i[3]}function qt(a){return A.randomInt(a)}function hs(a){for(var r=[],i=0;i<a;i++)r.push(qt(32).toString(32));return r.join("")}var ds=as,ps={getReceiveURL:function(a,r){return a.base+"/"+r+"/xhr_streaming"+a.queryString},onHeartbeat:function(a){a.sendRaw("[]")},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,r){a.onClose(1006,"Connection interrupted ("+r+")",!1)}},fs=ps,ms={getReceiveURL:function(a,r){return a.base+"/"+r+"/xhr"+a.queryString},onHeartbeat:function(){},sendHeartbeat:function(a){a.sendRaw("[]")},onFinished:function(a,r){r===200?a.reconnect():a.onClose(1006,"Connection interrupted ("+r+")",!1)}},gs=ms,ys={getRequest:function(a){var r=A.getXHRAPI(),i=new r;return i.onreadystatechange=i.onprogress=function(){switch(i.readyState){case 3:i.responseText&&i.responseText.length>0&&a.onChunk(i.status,i.responseText);break;case 4:i.responseText&&i.responseText.length>0&&a.onChunk(i.status,i.responseText),a.emit("finished",i.status),a.close();break}},i},abortRequest:function(a){a.onreadystatechange=null,a.abort()}},bs=ys,vs={createStreamingSocket(a){return this.createSocket(fs,a)},createPollingSocket(a){return this.createSocket(gs,a)},createSocket(a,r){return new ds(a,r)},createXHR(a,r){return this.createRequest(bs,a,r)},createRequest(a,r,i){return new is(a,r,i)}},Dt=vs;Dt.createXDR=function(a,r){return this.createRequest(rs,a,r)};var ws=Dt,_s={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:u,DependenciesReceivers:y,getDefaultStrategy:es,Transports:Ar,transportConnectionInitializer:ts,HTTPFactory:ws,TimelineTransport:yr,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(a){window.Pusher=a;var r=()=>{this.onDocumentBody(a.ready)};window.JSON?r():v.load("json2",{},r)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:se,jsonp:dr}},onDocumentBody(a){document.body?a():setTimeout(()=>{this.onDocumentBody(a)},0)},createJSONPRequest(a,r){return new fr(a,r)},createScriptRequest(a){return new pr(a)},getLocalStorage(){try{return window.localStorage}catch{return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var a=this.getXHRAPI();return new a},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return Lr},createWebSocket(a){var r=this.getWebSocketAPI();return new r(a)},createSocketRequest(a,r){if(this.isXHRSupported())return this.HTTPFactory.createXHR(a,r);if(this.isXDRSupported(r.indexOf("https:")===0))return this.HTTPFactory.createXDR(a,r);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var a=this.getXHRAPI();return!!a&&new a().withCredentials!==void 0},isXDRSupported(a){var r=a?"https:":"http:",i=this.getProtocol();return!!window.XDomainRequest&&i===r},addUnloadListener(a){window.addEventListener!==void 0?window.addEventListener("unload",a,!1):window.attachEvent!==void 0&&window.attachEvent("onunload",a)},removeUnloadListener(a){window.addEventListener!==void 0?window.removeEventListener("unload",a,!1):window.detachEvent!==void 0&&window.detachEvent("onunload",a)},randomInt(a){return Math.floor(function(){return(window.crypto||window.msCrypto).getRandomValues(new Uint32Array(1))[0]/Math.pow(2,32)}()*a)}},A=_s,et;(function(a){a[a.ERROR=3]="ERROR",a[a.INFO=6]="INFO",a[a.DEBUG=7]="DEBUG"})(et||(et={}));var Me=et;class ks{constructor(r,i,l){this.key=r,this.session=i,this.events=[],this.options=l||{},this.sent=0,this.uniqueID=0}log(r,i){r<=this.options.level&&(this.events.push(J({},i,{timestamp:W.now()})),this.options.limit&&this.events.length>this.options.limit&&this.events.shift())}error(r){this.log(Me.ERROR,r)}info(r){this.log(Me.INFO,r)}debug(r){this.log(Me.DEBUG,r)}isEmpty(){return this.events.length===0}send(r,i){var l=J({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);return this.events=[],r(l,(h,m)=>{h||this.sent++,i&&i(h,m)}),!0}generateUniqueID(){return this.uniqueID++,this.uniqueID}}class Ss{constructor(r,i,l,h){this.name=r,this.priority=i,this.transport=l,this.options=h||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(r,i){if(this.isSupported()){if(this.priority<r)return Bt(new P,i)}else return Bt(new H,i);var l=!1,h=this.transport.createConnection(this.name,this.priority,this.options.key,this.options),m=null,S=function(){h.unbind("initialized",S),h.connect()},T=function(){m=re.createHandshake(h,function(D){l=!0,I(),i(null,D)})},M=function(D){I(),i(D)},L=function(){I();var D;D=Te(h),i(new $(D))},I=function(){h.unbind("initialized",S),h.unbind("open",T),h.unbind("error",M),h.unbind("closed",L)};return h.bind("initialized",S),h.bind("open",T),h.bind("error",M),h.bind("closed",L),h.initialize(),{abort:()=>{l||(I(),m?m.close():h.close())},forceMinPriority:D=>{l||this.priority<D&&(m?m.close():h.close())}}}}function Bt(a,r){return W.defer(function(){r(a)}),{abort:function(){},forceMinPriority:function(){}}}const{Transports:Cs}=A;var Es=function(a,r,i,l,h,m){var S=Cs[i];if(!S)throw new q(i);var T=(!a.enabledTransports||St(a.enabledTransports,r)!==-1)&&(!a.disabledTransports||St(a.disabledTransports,r)===-1),M;return T?(h=Object.assign({ignoreNullOrigin:a.ignoreNullOrigin},h),M=new Ss(r,l,m?m.getAssistant(S):S,h)):M=Ts,M},Ts={isSupported:function(){return!1},connect:function(a,r){var i=W.defer(function(){r(new H)});return{abort:function(){i.ensureAborted()},forceMinPriority:function(){}}}};function xs(a){if(a==null)throw"You must pass an options object";if(a.cluster==null)throw"Options object must provide a cluster";"disableStats"in a&&N.warn("The disableStats option is deprecated in favor of enableStats")}const Ps=(a,r)=>{var i="socket_id="+encodeURIComponent(a.socketId);for(var l in r.params)i+="&"+encodeURIComponent(l)+"="+encodeURIComponent(r.params[l]);if(r.paramsProvider!=null){let h=r.paramsProvider();for(var l in h)i+="&"+encodeURIComponent(l)+"="+encodeURIComponent(h[l])}return i};var Ms=a=>{if(typeof A.getAuthorizers()[a.transport]>"u")throw`'${a.transport}' is not a recognized auth transport`;return(r,i)=>{const l=Ps(r,a);A.getAuthorizers()[a.transport](A,l,a,w.UserAuthentication,i)}};const As=(a,r)=>{var i="socket_id="+encodeURIComponent(a.socketId);i+="&channel_name="+encodeURIComponent(a.channelName);for(var l in r.params)i+="&"+encodeURIComponent(l)+"="+encodeURIComponent(r.params[l]);if(r.paramsProvider!=null){let h=r.paramsProvider();for(var l in h)i+="&"+encodeURIComponent(l)+"="+encodeURIComponent(h[l])}return i};var Rs=a=>{if(typeof A.getAuthorizers()[a.transport]>"u")throw`'${a.transport}' is not a recognized auth transport`;return(r,i)=>{const l=As(r,a);A.getAuthorizers()[a.transport](A,l,a,w.ChannelAuthorization,i)}};const Ls=(a,r,i)=>{const l={authTransport:r.transport,authEndpoint:r.endpoint,auth:{params:r.params,headers:r.headers}};return(h,m)=>{const S=a.channel(h.channelName);i(S,l).authorize(h.socketId,m)}};function Os(a,r){let i={activityTimeout:a.activityTimeout||g.activityTimeout,cluster:a.cluster,httpPath:a.httpPath||g.httpPath,httpPort:a.httpPort||g.httpPort,httpsPort:a.httpsPort||g.httpsPort,pongTimeout:a.pongTimeout||g.pongTimeout,statsHost:a.statsHost||g.stats_host,unavailableTimeout:a.unavailableTimeout||g.unavailableTimeout,wsPath:a.wsPath||g.wsPath,wsPort:a.wsPort||g.wsPort,wssPort:a.wssPort||g.wssPort,enableStats:qs(a),httpHost:Is(a),useTLS:js(a),wsHost:$s(a),userAuthenticator:Ds(a),channelAuthorizer:Us(a,r)};return"disabledTransports"in a&&(i.disabledTransports=a.disabledTransports),"enabledTransports"in a&&(i.enabledTransports=a.enabledTransports),"ignoreNullOrigin"in a&&(i.ignoreNullOrigin=a.ignoreNullOrigin),"timelineParams"in a&&(i.timelineParams=a.timelineParams),"nacl"in a&&(i.nacl=a.nacl),i}function Is(a){return a.httpHost?a.httpHost:a.cluster?`sockjs-${a.cluster}.pusher.com`:g.httpHost}function $s(a){return a.wsHost?a.wsHost:Ns(a.cluster)}function Ns(a){return`ws-${a}.pusher.com`}function js(a){return A.getProtocol()==="https:"?!0:a.forceTLS!==!1}function qs(a){return"enableStats"in a?a.enableStats:"disableStats"in a?!a.disableStats:!1}function Ds(a){const r=Object.assign(Object.assign({},g.userAuthentication),a.userAuthentication);return"customHandler"in r&&r.customHandler!=null?r.customHandler:Ms(r)}function Bs(a,r){let i;return"channelAuthorization"in a?i=Object.assign(Object.assign({},g.channelAuthorization),a.channelAuthorization):(i={transport:a.authTransport||g.authTransport,endpoint:a.authEndpoint||g.authEndpoint},"auth"in a&&("params"in a.auth&&(i.params=a.auth.params),"headers"in a.auth&&(i.headers=a.auth.headers)),"authorizer"in a&&(i.customHandler=Ls(r,i,a.authorizer))),i}function Us(a,r){const i=Bs(a,r);return"customHandler"in i&&i.customHandler!=null?i.customHandler:Rs(i)}class Hs extends ne{constructor(r){super(function(i,l){N.debug(`No callbacks on watchlist events for ${i}`)}),this.pusher=r,this.bindWatchlistInternalEvent()}handleEvent(r){r.data.events.forEach(i=>{this.emit(i.name,i)})}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",r=>{var i=r.event;i==="pusher_internal:watchlist_events"&&this.handleEvent(r)})}}function Fs(){let a,r;return{promise:new Promise((l,h)=>{a=l,r=h}),resolve:a,reject:r}}var zs=Fs;class Ws extends ne{constructor(r){super(function(i,l){N.debug("No callbacks on user for "+i)}),this.signin_requested=!1,this.user_data=null,this.serverToUserChannel=null,this.signinDonePromise=null,this._signinDoneResolve=null,this._onAuthorize=(i,l)=>{if(i){N.warn(`Error during signin: ${i}`),this._cleanup();return}this.pusher.send_event("pusher:signin",{auth:l.auth,user_data:l.user_data})},this.pusher=r,this.pusher.connection.bind("state_change",({previous:i,current:l})=>{i!=="connected"&&l==="connected"&&this._signin(),i==="connected"&&l!=="connected"&&(this._cleanup(),this._newSigninPromiseIfNeeded())}),this.watchlist=new Hs(r),this.pusher.connection.bind("message",i=>{var l=i.event;l==="pusher:signin_success"&&this._onSigninSuccess(i.data),this.serverToUserChannel&&this.serverToUserChannel.name===i.channel&&this.serverToUserChannel.handleEvent(i)})}signin(){this.signin_requested||(this.signin_requested=!0,this._signin())}_signin(){this.signin_requested&&(this._newSigninPromiseIfNeeded(),this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize))}_onSigninSuccess(r){try{this.user_data=JSON.parse(r.user_data)}catch{N.error(`Failed parsing user data after signin: ${r.user_data}`),this._cleanup();return}if(typeof this.user_data.id!="string"||this.user_data.id===""){N.error(`user_data doesn't contain an id. user_data: ${this.user_data}`),this._cleanup();return}this._signinDoneResolve(),this._subscribeChannels()}_subscribeChannels(){const r=i=>{i.subscriptionPending&&i.subscriptionCancelled?i.reinstateSubscription():!i.subscriptionPending&&this.pusher.connection.state==="connected"&&i.subscribe()};this.serverToUserChannel=new Ge(`#server-to-user-${this.user_data.id}`,this.pusher),this.serverToUserChannel.bind_global((i,l)=>{i.indexOf("pusher_internal:")===0||i.indexOf("pusher:")===0||this.emit(i,l)}),r(this.serverToUserChannel)}_cleanup(){this.user_data=null,this.serverToUserChannel&&(this.serverToUserChannel.unbind_all(),this.serverToUserChannel.disconnect(),this.serverToUserChannel=null),this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested||this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:r,resolve:i}=zs();r.done=!1;const l=()=>{r.done=!0};r.then(l).catch(l),this.signinDonePromise=r,this._signinDoneResolve=i}}class z{static ready(){z.isReady=!0;for(var r=0,i=z.instances.length;r<i;r++)z.instances[r].connect()}static getClientFeatures(){return Ct(xt({ws:A.Transports.ws},function(r){return r.isSupported({})}))}constructor(r,i){Xs(r),xs(i),this.key=r,this.config=Os(i,this),this.channels=re.createChannels(),this.global_emitter=new ne,this.sessionID=A.randomInt(1e9),this.timeline=new ks(this.key,this.sessionID,{cluster:this.config.cluster,features:z.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:Me.INFO,version:g.VERSION}),this.config.enableStats&&(this.timelineSender=re.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+A.TimelineTransport.name}));var l=h=>A.getDefaultStrategy(this.config,h,Es);this.connection=re.createConnectionManager(this.key,{getStrategy:l,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:!!this.config.useTLS}),this.connection.bind("connected",()=>{this.subscribeAll(),this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}),this.connection.bind("message",h=>{var m=h.event,S=m.indexOf("pusher_internal:")===0;if(h.channel){var T=this.channel(h.channel);T&&T.handleEvent(h)}S||this.global_emitter.emit(h.event,h.data)}),this.connection.bind("connecting",()=>{this.channels.disconnect()}),this.connection.bind("disconnected",()=>{this.channels.disconnect()}),this.connection.bind("error",h=>{N.warn(h)}),z.instances.push(this),this.timeline.info({instances:z.instances.length}),this.user=new Ws(this),z.isReady&&this.connect()}channel(r){return this.channels.find(r)}allChannels(){return this.channels.all()}connect(){if(this.connection.connect(),this.timelineSender&&!this.timelineSenderTimer){var r=this.connection.isUsingTLS(),i=this.timelineSender;this.timelineSenderTimer=new er(6e4,function(){i.send(r)})}}disconnect(){this.connection.disconnect(),this.timelineSenderTimer&&(this.timelineSenderTimer.ensureAborted(),this.timelineSenderTimer=null)}bind(r,i,l){return this.global_emitter.bind(r,i,l),this}unbind(r,i,l){return this.global_emitter.unbind(r,i,l),this}bind_global(r){return this.global_emitter.bind_global(r),this}unbind_global(r){return this.global_emitter.unbind_global(r),this}unbind_all(r){return this.global_emitter.unbind_all(),this}subscribeAll(){var r;for(r in this.channels.channels)this.channels.channels.hasOwnProperty(r)&&this.subscribe(r)}subscribe(r){var i=this.channels.add(r,this);return i.subscriptionPending&&i.subscriptionCancelled?i.reinstateSubscription():!i.subscriptionPending&&this.connection.state==="connected"&&i.subscribe(),i}unsubscribe(r){var i=this.channels.find(r);i&&i.subscriptionPending?i.cancelSubscription():(i=this.channels.remove(r),i&&i.subscribed&&i.unsubscribe())}send_event(r,i,l){return this.connection.send_event(r,i,l)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}z.instances=[],z.isReady=!1,z.logToConsole=!1,z.Runtime=A,z.ScriptReceivers=A.ScriptReceivers,z.DependenciesReceivers=A.DependenciesReceivers,z.auth_callbacks=A.auth_callbacks;var tt=n.default=z;function Xs(a){if(a==null)throw"You must pass your app key when you instantiate Pusher."}A.setup(z)}])})}(lt)),lt.exports}var Go=Jo();const Vo=Xo(Go);window.Pusher=Vo;window.Echo=new Wo({broadcaster:"reverb",key:"a0qe9l3hjuffbv7oqflw",wsHost:"127.0.0.1",wsPort:"8080",wssPort:"8080",forceTLS:!1,enabledTransports:["ws","wss"],auth:{headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}});window.axios=j;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";class Ko{constructor(){this.character=null,this.currentMap=null,this.monsters=[],this.shops=[],this.otherPlayers=[],this.initDomElements(),this.loadGameData(),this.skillCooldownInterval=null}initDomElements(){this.gameMap=document.getElementById("game-map"),this.player=document.getElementById("player"),this.characterInfo=document.getElementById("character-details"),this.skillsList=document.getElementById("skills-list"),this.inventoryList=document.getElementById("inventory-list"),this.messages=document.getElementById("messages"),this.gameMap&&this.player?(this.createGameControls(),this.initEventListeners()):(console.error("游戏DOM元素未找到，请确保HTML结构正确"),this.messages&&this.addMessage("游戏初始化失败，请刷新页面重试","error"))}createGameControls(){let e=document.querySelector(".game-controls");e&&e.remove(),e=document.createElement("div"),e.className="game-controls",[{icon:"❓",title:"游戏帮助",action:"showHelp"},{icon:"🔍",title:"查看地图",action:"showMapInfo"},{icon:"🗺️",title:"地图指南",action:"showMapGuide"},{icon:"💰",title:"商店指南",action:"showShopGuide"},{icon:"⚔️",title:"战斗指南",action:"showCombatGuide"}].forEach(o=>{const c=document.createElement("div");c.className="control-btn",c.innerHTML=o.icon,c.title=o.title,c.dataset.action=o.action,c.addEventListener("click",()=>this.handleControlAction(o.action)),e.appendChild(c)});const n=document.querySelector(".vertical-sidebar");if(n){const o=document.createElement("div");o.className="section controls-section";const c=document.createElement("h3");c.textContent="游戏指南",o.appendChild(c),o.appendChild(e),n.insertBefore(o,n.firstChild)}else{const o=document.querySelector(".game-container");o?(e.classList.add("top-controls"),o.insertBefore(e,o.firstChild)):document.body.appendChild(e)}}handleControlAction(e){switch(e){case"showHelp":this.showGameHelp();break;case"showMapInfo":this.showMapInfo();break;case"showMapGuide":this.showMapGuide();break;case"showShopGuide":this.showShopGuide();break;case"showCombatGuide":this.showCombatGuide();break}}showGameHelp(){this.addMessage("==== 游戏帮助 ====","system"),this.addMessage("- 点击地图移动角色","info"),this.addMessage("- 点击怪物进行攻击","info"),this.addMessage("- 点击商店进行购物","info"),this.addMessage("- 点击传送点前往其他地图","info"),this.addMessage("- 使用技能栏中的技能","info")}showMapInfo(){this.currentMap?(this.addMessage("==== 地图信息 ====","system"),this.addMessage(`地图: ${this.currentMap.name}`,"info"),this.addMessage(`描述: ${this.currentMap.description||"无描述"}`,"info"),this.addMessage(`当前位置: (${this.character.position_x}, ${this.character.position_y})`,"info"),this.addMessage(`怪物数量: ${this.monsters.filter(e=>!e.is_dead).length}`,"info"),this.addMessage(`商店数量: ${this.shops.length}`,"info")):this.addMessage("地图数据未加载","error")}showMapGuide(){this.addMessage("==== 地图指南 ====","system"),this.addMessage("游戏世界由以下地图组成：","info"),this.addMessage("1. 新手村 - 初始区域，适合新手（等级需求：1级）","info"),this.addMessage("2. 幽暗森林 - 茂密的森林，隐藏着危险生物（等级需求：5级）","info"),this.addMessage("3. 古老矿洞 - 昏暗的地下洞窟，曾是矮人的矿场（等级需求：10级）","info"),this.addMessage("4. 炽热沙漠 - 荒芜的沙漠，隐藏着远古遗迹（等级需求：15级）","info"),this.addMessage("寻找紫色的传送点，点击后可传送到其他地图","info");const e=document.querySelectorAll(".teleport-point");e.length>0?(this.addMessage(`当前地图上有 ${e.length} 个传送点`,"success"),this.addMessage("将鼠标悬停在传送点上可查看目标地图","info")):this.addMessage("当前地图上没有传送点","warning")}showShopGuide(){this.addMessage("==== 商店指南 ====","system"),this.addMessage("- 点击地图上的商店图标打开商店","info"),this.addMessage("- 每个商店出售不同的物品","info"),this.addMessage("- 金币不足时无法购买物品","info"),this.addMessage("- 使用物品可以恢复生命值或魔法值","info"),this.addMessage("- 装备物品可以提升属性","info"),this.addMessage(`您当前的金币: ${this.character.gold||0}`,"gold")}showCombatGuide(){this.addMessage("==== 战斗指南 ====","system"),this.addMessage("- 点击怪物开始战斗","info"),this.addMessage("- 普通攻击不消耗魔法值","info"),this.addMessage("- 使用技能可以造成更高伤害","info"),this.addMessage("- 击败怪物获得经验和金币","info"),this.addMessage("- 获得足够经验可以升级","info"),this.addMessage(`您当前的攻击力: ${this.character.attack}`,"combat"),this.addMessage(`您当前的防御力: ${this.character.defense}`,"combat")}initEventListeners(){var e,t;this.gameMap&&(this.gameMap.addEventListener("click",n=>{if(n.target.classList.contains("monster")||n.target.classList.contains("shop")||n.target.classList.contains("teleport-point"))return;const o=this.gameMap.getBoundingClientRect(),c=Math.round(n.clientX-o.left),u=Math.round(n.clientY-o.top);console.log(`地图点击事件: (${c}, ${u})`),this.moveCharacter(c,u)}),this.gameMap.addEventListener("click",n=>{if(n.target.classList.contains("monster")){const o=n.target.dataset.monsterId;o&&this.showMonsterModal(o)}}),this.gameMap.addEventListener("click",n=>{if(n.target.classList.contains("shop")){const o=n.target.dataset.shopId;o&&this.showShopModal(o)}})),this.skillsList.addEventListener("click",n=>{const o=n.target.closest(".skill");if(o){const c=o.dataset.skillId;this.toggleAutoSkill(c)}}),this.inventoryList&&this.inventoryList.addEventListener("click",n=>{const o=n.target.closest(".item");if(o){const c=o.dataset.itemId;c&&this.showItemModal(c)}}),(e=document.getElementById("attack-monster"))==null||e.addEventListener("click",()=>{this.attackMonster()}),(t=document.getElementById("auto-attack-btn"))==null||t.addEventListener("click",()=>{this.toggleAutoAttack()}),document.querySelectorAll(".modal .close").forEach(n=>{n.addEventListener("click",()=>{n.closest(".modal").style.display="none"})})}initWebSocket(){if(!this.character){console.warn("WebSocket初始化延迟：角色数据尚未加载");return}if(!this.character.id){console.warn("WebSocket初始化延迟：角色ID不存在");return}const e=this.character.current_map_id||this.character.map_id;if(!e){console.warn("WebSocket初始化延迟：地图ID不存在");return}console.log("初始化WebSocket连接，角色ID:",this.character.id,"地图ID:",e),this.mapChannel&&(console.log("离开之前的地图频道:",this.mapChannel.name),typeof this.mapChannel.unsubscribe=="function"&&this.mapChannel.unsubscribe(),this.mapChannel=null),setTimeout(()=>{try{if(this.mapChannel=window.Echo.join(`map.${e}`),!this.mapChannel){console.error("创建地图频道失败");return}console.log("成功创建地图频道:",`map.${e}`),this.mapChannel.listen(".game.event",t=>{console.log("收到原始游戏事件数据:",t),t&&t.type?(console.log(`处理游戏事件: ${t.type}`,t.data),this.handleGameEvent({type:t.type,data:t.data})):console.warn("收到无效的游戏事件数据:",t)}),this.mapChannel.listenToAll((t,n)=>{console.log(`收到地图频道事件: ${t}`,n)}),this.mapChannel.here(t=>{console.log("当前在线玩家:",t),t.forEach(n=>this.handleCharacterEnter({character:n}))}),this.mapChannel.joining(t=>{console.log("玩家加入地图:",t),this.handleCharacterEnter({character:t})}),this.mapChannel.leaving(t=>{console.log("玩家离开地图:",t),t&&t.id&&(this.handleCharacterExit({character_id:t.id,character:t}),this.addMessage(`${t.name||"玩家"} 离开了地图`))}),console.log("准备发送地图进入通知，角色数据:",{id:this.character.id,map_id:e,name:this.character.name}),axios.post("/api/map/enter",{map_id:e,character_id:this.character.id}).then(t=>{console.log("发送地图进入通知成功:",t.data)}).catch(t=>{console.error("发送地图进入通知失败:",t),t.response&&(console.error("错误状态码:",t.response.status),console.error("错误数据:",t.response.data),this.addMessage(`地图进入通知失败: ${t.response.data.message}`,"error"))}),console.log("WebSocket初始化完成")}catch(t){console.error("WebSocket初始化失败:",t),this.addMessage("WebSocket连接失败，部分功能可能不可用","error")}},500)}async loadGameData(){try{console.log("正在检查localStorage中的token...");const e=localStorage.getItem("game_token");console.log("localStorage中的所有键:");for(let o=0;o<localStorage.length;o++){const c=localStorage.key(o);console.log(`- ${c}: ${localStorage.getItem(c).substring(0,10)}...`)}if(!e){console.error("未找到认证令牌，请先登录"),this.addMessage("未找到认证令牌，请先登录");const o=document.getElementById("login-prompt");o&&(o.style.display="block");return}axios.defaults.headers.common.Authorization=`Bearer ${e}`,axios.interceptors.response.use(o=>o,o=>(console.error("请求失败:",o),o.response&&o.response.data&&(console.error("错误响应数据:",o.response.data),o.responseData=o.response.data),Promise.reject(o)));const t=await axios.get("/api/character");if(!t.data.character||!t.data.character.id)throw console.error("获取到的角色数据无效:",t.data),this.addMessage("角色数据无效，请重新登录","error"),new Error("角色数据无效");this.character=t.data.character,this.character.gold=t.data.gold||0,console.log("获取到角色数据:",this.character),this.updateCharacterInfo();try{if(console.log("开始加载地图数据"),await this.loadMapData(),console.log("地图数据加载成功，准备初始化WebSocket"),!this.character.id||!this.character.current_map_id){console.error("角色或地图数据不完整:",this.character),this.addMessage("角色或地图数据不完整，请刷新页面","error");return}this.initWebSocket()}catch(o){console.error("地图数据加载失败，WebSocket初始化延迟:",o),this.addMessage("地图加载失败，部分游戏功能可能不可用","warning")}try{const o=await axios.get("/api/skills");console.log("获取到技能数据:",o.data),this.updateSkillsList(o.data.skills)}catch(o){console.error("加载技能数据失败:",o),this.addMessage("技能数据加载失败","warning")}try{const o=await axios.get("/api/inventory");console.log("获取到背包数据:",o.data),this.updateInventoryList(o.data.inventory)}catch(o){console.error("加载背包数据失败:",o),this.addMessage("背包数据加载失败","warning")}const n=document.getElementById("loading-screen");n&&(n.style.display="none"),this.addMessage("游戏加载完成","success")}catch(e){if(console.error("加载游戏数据失败:",e),e.response&&(console.error("错误状态码:",e.response.status),console.error("错误数据:",e.response.data),e.response.status===401)){console.error("认证失败，令牌可能已过期"),localStorage.removeItem("game_token"),this.addMessage("登录已过期，请重新登录","error"),window.location.href="/login";return}this.addMessage("加载游戏数据失败，请刷新页面重试","error");const t=e.response&&e.response.data.message?e.response.data.message:e.message;this.addMessage(`错误信息: ${t}`,"error");const n=document.getElementById("login-prompt");n&&(n.style.display="block")}}loadMapData(){if(!this.character)return console.warn("加载地图数据失败：角色数据不存在"),Promise.reject(new Error("角色数据不存在"));const e=this.character.current_map_id||this.character.map_id;if(!e)return console.warn("加载地图数据失败：地图ID不存在"),Promise.reject(new Error("地图ID不存在"));const t=this.currentMap?this.currentMap.id:null;return console.log(`开始加载地图数据，从地图 #${t} 到 #${e}`),axios.get(`/api/map/${e}`).then(n=>{const o=n.data;if(o.success!==!1){this.currentMap=o.map,this.monsters=o.monsters||[],this.shops=o.shops||[],this.otherPlayers=o.other_players||[],this.updateMap();const c=this.character.current_map_id||this.character.map_id;if(c!==t){console.log(`地图已从 #${t} 变更为 #${c}`),this.addMessage(`进入 ${this.currentMap.name}`);const u=document.getElementById("map-indicator");u&&(u.textContent=this.currentMap.name)}return console.log("地图数据加载完成"),o}else return console.error("获取地图数据失败:",o),this.addMessage("无法加载地图数据，请重试"),Promise.reject(new Error("地图数据无效"))}).catch(n=>(console.error("加载地图数据异常:",n),this.addMessage("加载地图失败，请检查网络连接"),Promise.reject(n)))}updateCharacterInfo(){if(!this.characterInfo||!this.character){console.error("角色信息容器或数据未找到，无法更新角色信息");return}const e=this.character.exp_to_level||this.character.level*100;this.characterInfo.innerHTML=`
            <p>名称：${this.character.name}</p>
            <p>等级：${this.character.level}</p>
            <p>经验：${this.character.exp}/${e}</p>
            <p>生命：${this.character.current_hp}/${this.character.max_hp}</p>
            <p>魔法：${this.character.current_mp}/${this.character.max_mp}</p>
            <p>攻击：${this.character.attack}</p>
            <p>防御：${this.character.defense}</p>
            <p>金币：${this.character.gold||0}</p>
            <p>位置：(${this.character.position_x}, ${this.character.position_y})</p>
        `}updateMap(){if(!this.gameMap){console.error("地图容器未找到，无法更新地图");return}this.gameMap.style.width=`${this.currentMap.width}px`,this.gameMap.style.height=`${this.currentMap.height}px`,this.currentMap.background_image&&(this.gameMap.style.backgroundImage=`url('/images/${this.currentMap.background_image}')`),this.updatePlayerPosition(),this.updateMonsters(),this.updateOtherPlayers(),this.updateShops(),this.updateTeleportPoints()}updatePlayerPosition(){if(!this.character||!this.gameMap){console.error("无法更新玩家位置：角色数据或地图容器不存在");return}let e=document.querySelector(".player:not(.other-player)");e||(e=document.createElement("div"),e.className="player",this.gameMap.appendChild(e),console.log("创建了新的玩家元素")),e.style.left=`${this.character.position_x}px`,e.style.top=`${this.character.position_y}px`,e.innerHTML=`${this.character.name} <span class="player-level">Lv.${this.character.level}</span>`,console.log(`更新玩家位置: (${this.character.position_x}, ${this.character.position_y}), CSS位置: left=${e.style.left}, top=${e.style.top}`)}updateMonsters(){if(!this.gameMap||!this.monsters){console.error("地图容器或怪物数据未找到，无法更新怪物");return}console.log(`更新怪物显示，当前怪物列表: ${this.monsters.length}个怪物`),document.querySelectorAll(".monster").forEach(t=>t.remove());const e=this.monsters.filter(t=>!t.is_dead);console.log(`添加${e.length}个活着的怪物到地图`),e.forEach(t=>{const n=document.createElement("div");n.className="monster",n.dataset.monsterId=t.id,n.style.left=`${t.position_x}px`,n.style.top=`${t.position_y}px`,n.innerHTML=t.name,n.title=`${t.name} Lv.${t.level||"?"} (点击攻击)`,this.gameMap.appendChild(n)})}updateOtherPlayers(){if(document.querySelectorAll(".other-player").forEach(t=>t.remove()),!this.gameMap){console.error("找不到地图容器，无法更新其他玩家");return}this.otherPlayers.forEach(t=>{const n=document.createElement("div");n.className="player other-player",n.dataset.playerId=t.id,n.innerHTML=`${t.name} <span class="player-level">Lv.${t.level||1}</span>`,n.title=`${t.name} (等级 ${t.level||1})`,t.position_x!==void 0&&t.position_y!==void 0?(n.style.left=`${t.position_x}px`,n.style.top=`${t.position_y}px`,console.log(`设置玩家 ${t.name} 位置: (${t.position_x}, ${t.position_y}), CSS位置: left=${n.style.left}, top=${n.style.top}`)):(console.warn(`玩家 ${t.name} 缺少位置信息:`,t),n.style.left="100px",n.style.top="100px"),this.gameMap.appendChild(n)}),console.log(`更新了 ${this.otherPlayers.length} 个其他玩家`)}updateShops(){if(!this.gameMap||!this.shops){console.error("地图容器或商店数据未找到，无法更新商店");return}document.querySelectorAll(".shop").forEach(e=>e.remove()),this.shops.forEach(e=>{const t=document.createElement("div");t.className="shop",t.dataset.shopId=e.id,t.style.left=`${e.position_x}px`,t.style.top=`${e.position_y}px`,t.innerHTML=e.name,t.title=`${e.name} (点击购物)`,this.gameMap.appendChild(t)})}updateSkillsList(e){if(!this.skillsList){console.error("技能列表容器未找到，无法更新技能列表");return}if(!e||!e.length){this.skillsList.innerHTML="<p>暂无技能</p>";return}this.skills=e.map(t=>({...t,is_auto_attacking:!1,cooldown_remaining:0,last_used:null})),this.renderSkillsList(),this.skillCooldownInterval||(this.skillCooldownInterval=setInterval(()=>this.updateSkillCooldowns(),1e3))}renderSkillsList(){!this.skillsList||!this.skills||(this.skillsList.innerHTML=this.skills.map(e=>{const t=e.cooldown_remaining>0?`<div class="skill-cooldown">${e.cooldown_remaining}秒</div>`:"";return`
                <div class="skill ${e.is_auto_attacking?"skill-auto-active":""}" data-skill-id="${e.id}">
                    <div class="skill-icon">${e.skill.icon||"技"}</div>
                    <div class="skill-info">
                        <div>${e.skill.name} Lv.${e.level}</div>
                        <div>MP消耗：${e.skill.mp_cost}</div>
                        ${t}
                    </div>
                    <div class="skill-auto-indicator">${e.is_auto_attacking?"自动":""}</div>
                </div>
            `}).join(""))}updateSkillCooldowns(){let e=!1;this.skills.forEach(t=>{t.cooldown_remaining>0&&(t.cooldown_remaining--,e=!0),t.cooldown_remaining===0&&t.is_auto_attacking&&this.tryAutoUseSkill(t)}),e&&this.renderSkillsList()}async tryAutoUseSkill(e){if(!this.monsters||this.monsters.length===0)return;const t=this.monsters.filter(o=>!o.is_dead);if(t.length===0)return;const n=t[0];try{await this.useSkill(e.id,n.id)}catch(o){console.error("自动释放技能失败:",o)}}async useSkill(e,t){try{const n=this.skills.find(c=>c.id===parseInt(e));if(!n){console.error("未找到技能:",e);return}if(n.cooldown_remaining>0){this.addMessage(`技能 ${n.skill.name} 正在冷却中，剩余 ${n.cooldown_remaining} 秒`,"warning");return}const o=await axios.post("/api/skill/use",{skill_id:e,monster_id:t});n.cooldown_remaining=n.skill.cooldown||0,n.last_used=new Date,this.renderSkillsList(),this.handleCombatResult(o.data)}catch(n){console.error("使用技能失败:",n),this.addMessage("使用技能失败")}}updateInventoryList(e){if(!this.inventoryList){console.error("背包列表容器未找到，无法更新背包列表");return}if(!e||!e.length){this.inventoryList.innerHTML="<p>背包为空</p>";return}this.inventory=e,document.querySelectorAll(".item-tooltip").forEach(t=>t.remove()),this.inventoryList.innerHTML=e.map(t=>`
            <div class="item" data-item-id="${t.id}">
                <div class="item-icon">${t.item.image||"物"}</div>
                ${t.quantity>1?`<span class="item-badge">${t.quantity}</span>`:""}
                ${t.is_equipped?'<span class="item-equipped">已装备</span>':""}
            </div>
        `).join(""),document.querySelectorAll("#inventory-list .item").forEach(t=>{const n=t.dataset.itemId,o=this.inventory.find(c=>c.id===parseInt(n));o&&t.addEventListener("click",c=>{c.stopPropagation(),document.querySelectorAll(".item-tooltip").forEach(g=>g.remove());const u=document.createElement("div");u.className="item-tooltip",u.innerHTML=`
                        <div class="item-tooltip-header">
                            <div class="item-tooltip-icon">${o.item.image||"物"}</div>
                            <div class="item-tooltip-title">
                                <div class="item-tooltip-name">${o.item.name}</div>
                                <div class="item-tooltip-quantity">数量: ${o.quantity}</div>
                            </div>
                            <div class="tooltip-close">×</div>
                        </div>
                        <div class="item-tooltip-description">${o.item.description||"无描述"}</div>
                        ${this.getItemAttributesHTML(o.item)}
                        ${o.is_equipped?'<div class="item-tooltip-equipped">已装备</div>':""}
                        <div class="item-tooltip-actions">
                            ${o.item.is_consumable?`<button class="item-action-btn use-btn" data-action="use" data-item-id="${o.id}">使用</button>`:""}
                            ${o.item.type==="equipment"?o.is_equipped?`<button class="item-action-btn unequip-btn" data-action="unequip" data-item-id="${o.id}">卸下</button>`:`<button class="item-action-btn equip-btn" data-action="equip" data-item-id="${o.id}">装备</button>`:""}
                            <button class="item-action-btn drop-btn" data-action="drop" data-item-id="${o.id}">丢弃</button>
                        </div>
                    `,document.body.appendChild(u),this.positionTooltip(u,c),u.querySelector(".tooltip-close").addEventListener("click",g=>{g.stopPropagation(),u.parentNode&&u.parentNode.removeChild(u)}),u.querySelectorAll(".item-action-btn").forEach(g=>{g.addEventListener("click",b=>{b.stopPropagation();const y=g.dataset.action,v=parseInt(g.dataset.itemId);switch(y){case"use":this.useItem(v);break;case"equip":this.equipItem(v);break;case"unequip":this.unequipItem(v);break;case"drop":this.dropItem(v);break}u.parentNode&&u.parentNode.removeChild(u)})});const d=g=>{!u.contains(g.target)&&!t.contains(g.target)&&u.parentNode&&(u.parentNode.removeChild(u),document.removeEventListener("click",d))};setTimeout(()=>{document.addEventListener("click",d)},100)})})}getItemAttributesHTML(e){if(!e)return"";let t='<div class="item-tooltip-attributes">';return e.type&&(t+=`<div class="item-attribute">类型: ${this.getItemTypeName(e.type)}</div>`),e.rarity&&(t+=`<div class="item-attribute item-rarity-${e.rarity}">稀有度: ${this.getItemRarityName(e.rarity)}</div>`),e.hp_bonus>0&&(t+=`<div class="item-attribute item-bonus">生命值: +${e.hp_bonus}</div>`),e.mp_bonus>0&&(t+=`<div class="item-attribute item-bonus">魔法值: +${e.mp_bonus}</div>`),e.attack_bonus>0&&(t+=`<div class="item-attribute item-bonus">攻击力: +${e.attack_bonus}</div>`),e.defense_bonus>0&&(t+=`<div class="item-attribute item-bonus">防御力: +${e.defense_bonus}</div>`),e.price>0&&(t+=`<div class="item-attribute">价值: ${e.price}金币</div>`),t+="</div>",t}getItemTypeName(e){return{weapon:"武器",armor:"护甲",accessory:"饰品",consumable:"消耗品",material:"材料",quest:"任务物品",skill_book:"技能书",equipment:"装备"}[e]||e}getItemRarityName(e){return{1:"普通",2:"优秀",3:"精良",4:"稀有",5:"史诗",6:"传说"}[e]||e}positionTooltip(e,t){const o=e.offsetWidth,c=e.offsetHeight;let u=t.clientX+10,d=t.clientY+10;u+o>window.innerWidth&&(u=t.clientX-o-10),d+c>window.innerHeight&&(d=t.clientY-c-10),e.style.left=`${u}px`,e.style.top=`${d}px`}updateTeleportPoints(){if(!this.gameMap||!this.currentMap){console.warn("无法更新传送点: gameMap或currentMap为空");return}document.querySelectorAll(".teleport-point, .map-label, .map-indicator").forEach(n=>n.remove());let e=[];if(typeof this.currentMap.teleport_points=="string")try{e=JSON.parse(this.currentMap.teleport_points),console.log("已解析传送点数据:",e)}catch(n){console.error("解析传送点数据失败:",n),this.addMessage("解析传送点数据失败","error")}else if(Array.isArray(this.currentMap.teleport_points))e=this.currentMap.teleport_points;else{console.warn("传送点数据格式不正确:",this.currentMap.teleport_points),this.addMessage("此地图上没有有效的传送点数据","warning");return}e.length>0?(console.log(`正在添加${e.length}个传送点`),e.forEach(n=>{const o=document.createElement("div");o.className="teleport-point",o.style.left=`${n.x}px`,o.style.top=`${n.y}px`;const c=n.target_map_name||`地图${n.target_map_id}`;o.dataset.targetMapId=n.target_map_id,o.dataset.targetX=n.target_x,o.dataset.targetY=n.target_y,o.addEventListener("click",()=>{this.showTeleportConfirm(n.target_map_id,n.target_x,n.target_y,c)}),o.title=`传送到${c}`,this.gameMap.appendChild(o);const u=document.createElement("div");u.className="map-label",u.textContent=c,u.style.left=`${n.x}px`,u.style.top=`${n.y-10}px`,this.gameMap.appendChild(u)}),this.addMessage(`此地图上有${e.length}个传送点`,"info")):(console.warn("没有传送点数据"),this.addMessage("此地图上没有传送点","info"));const t=document.createElement("div");t.className="map-indicator",t.textContent=`当前地图: ${this.currentMap.name}`,this.gameMap.appendChild(t)}showTeleportConfirm(e,t,n,o){this.addMessage(`准备传送到${o}...`,"system");let c=document.querySelector(".map-transition");c?c.innerHTML=`<div class="loading-text">正在加载 ${o}...</div>`:(c=document.createElement("div"),c.className="map-transition",c.innerHTML=`<div class="loading-text">正在加载 ${o}...</div>`,document.body.appendChild(c)),setTimeout(()=>{c.classList.add("active"),setTimeout(async()=>{await this.teleportToMap(e,t,n),c.classList.remove("active")},300)},50)}async teleportToMap(e,t,n){try{const o=t!==void 0?t:null,c=n!==void 0?n:null;this.showTeleportingEffect();const u=await axios.post("/api/map/change",{map_id:e,target_x:o,target_y:c});this.character=u.data.character,this.currentMap=u.data.map,await this.loadMapData(),this.addMessage(`成功传送到${this.currentMap.name}`,"success"),this.character.level<this.currentMap.level_required&&this.addMessage(`警告: 您的等级低于地图要求(${this.currentMap.level_required}级)，将面临更大危险！`,"warning"),this.showTeleportCompleteEffect();const d=document.querySelector(".game-map-container");d&&(d.style.display="block")}catch(o){if(console.error("传送失败:",o),o.response&&(console.error("错误状态码:",o.response.status),console.error("错误数据:",o.response.data),o.response.data&&o.response.data.message)){this.addMessage(`传送失败: ${o.response.data.message}`,"error");return}this.addMessage("传送失败，请重试","error");const c=document.querySelector(".map-transition");c&&c.classList.remove("active")}}showTeleportingEffect(){const e=document.getElementById("player");e&&(e.classList.add("teleporting"),setTimeout(()=>{e.classList.remove("teleporting")},2e3))}showTeleportCompleteEffect(){const e=document.getElementById("player");e&&(e.classList.add("teleport-complete"),setTimeout(()=>{e.classList.remove("teleport-complete")},1e3))}async moveCharacter(e,t){if(!this.character){console.error("无法移动角色：角色数据不存在");return}if(this.isTeleporting){console.log("角色正在传送中，忽略移动请求");return}console.log(`尝试移动角色到坐标: (${e}, ${t})`);try{const n=await axios.post("/api/character/move",{x:e,y:t,map_id:this.character.current_map_id||this.character.map_id});console.log("移动成功，服务器响应:",n.data),n.data.character&&(this.character=n.data.character,console.log(`角色位置已更新为: (${this.character.position_x}, ${this.character.position_y})`),this.updatePlayerPosition())}catch(n){if(console.error("移动失败:",n),n.response&&(console.error("错误状态码:",n.response.status),console.error("错误数据:",n.response.data),n.response.data&&n.response.data.message&&n.response.data.message.includes("等级不够"))){this.addMessage(n.response.data.message,"error");return}this.addMessage("移动失败","error")}}checkTeleportPoint(e,t){if(!this.currentMap||!this.currentMap.teleport_points)return null;const n=30;return Array.isArray(this.currentMap.teleport_points)?this.currentMap.teleport_points.find(c=>Math.sqrt(Math.pow(c.x-e,2)+Math.pow(c.y-t,2))<=n):null}async showMonsterModal(e){try{const t=this.monsters.find(v=>v.id===parseInt(e));if(!t){console.error("未找到怪物:",e);return}console.log("显示怪物信息:",t);const n=document.getElementById("monster-modal"),o=document.getElementById("monster-name"),c=document.getElementById("monster-level"),u=document.getElementById("monster-hp"),d=document.getElementById("monster-hp-bar"),g=document.getElementById("attack-btn"),b=document.getElementById("skill-btn"),y=document.getElementById("auto-attack-btn");n.dataset.monsterId=t.id,o.textContent=t.name,c.textContent=`等级 ${t.level}`,u.textContent=`${t.current_hp}/${t.hp}`,d.style.width=`${t.hp_percentage}%`,this.isAutoAttacking=!1,y&&(y.textContent="自动攻击",y.classList.remove("active")),n.style.display="block"}catch(t){console.error("显示怪物信息失败:",t)}}async showShopModal(e){try{const t=await axios.get(`/api/shop/${e}`),n=t.data.shop,o=t.data.shop_items,c=document.getElementById("shop-name"),u=document.getElementById("shop-items"),d=document.getElementById("shop-modal");if(!c||!u||!d){console.error("商店模态框元素未找到");return}const g=await axios.get("/api/character");this.character.gold=g.data.gold||0,c.innerHTML=`${n.name} <span class="player-gold">您的金币: ${this.character.gold}</span>`,u.innerHTML=o.map(b=>{const y=this.character.gold>=b.price,v=y?"can-afford":"cannot-afford",C=y?`<button class="btn buy-btn" onclick="game.buyItem(${b.id})">购买</button>`:'<button class="btn buy-btn disabled" title="金币不足">购买</button>';return`
                <div class="item ${v}" data-shop-item-id="${b.id}">
                    <div class="item-icon">${b.item.image||"物"}</div>
                    <div class="item-info">
                        <div>${b.item.name}</div>
                        <div class="price-info">价格：${b.price}金币 ${y?"":'<span class="not-enough">(金币不足)</span>'}</div>
                        <div class="item-description">${b.item.description||""}</div>
                    </div>
                    ${C}
                </div>
                `}).join(""),d.style.display="block",this.addMessage(`您正在浏览${n.name}，您有${this.character.gold}金币可用于购买`)}catch(t){console.error("获取商店信息失败:",t),this.addMessage("获取商店信息失败")}}showItemModal(e){console.log("物品操作已移至弹出窗口，不再需要模态框")}toggleAutoSkill(e){const t=this.skills.find(o=>o.id===parseInt(e));if(!t){console.error("未找到技能:",e);return}t.is_auto_attacking=!t.is_auto_attacking;const n=t.is_auto_attacking?"开启":"关闭";this.addMessage(`已${n}技能 ${t.skill.name} 的自动释放`,"info"),this.renderSkillsList(),t.is_auto_attacking&&t.cooldown_remaining===0&&this.tryAutoUseSkill(t)}async attackMonster(){const e=document.getElementById("monster-modal").dataset.monsterId;try{console.log("开始攻击怪物，ID:",e),await axios.post("/api/test/log",{action:"attack_monster",monster_id:e,timestamp:new Date().toISOString()});const t=await axios.post("/api/monster/attack",{monster_id:e});if(console.log("攻击怪物响应:",t.data),t.data.monster){const n=this.monsters.find(o=>o.id===parseInt(e));if(n){console.log("更新前怪物数据:",{...n}),n.current_hp=t.data.monster.current_hp,n.hp_percentage=t.data.monster.current_hp/t.data.monster.hp*100,t.data.monster_killed&&(n.is_dead=!0,this.isAutoAttacking=!1),console.log("更新后怪物数据:",{...n});const o=document.getElementById("monster-modal");if(o&&o.style.display==="block"){const c=o.querySelector(".monster-hp");c?(console.log("更新怪物血量文本:",`${t.data.monster.current_hp}/${t.data.monster.hp}`),c.textContent=`${t.data.monster.current_hp}/${t.data.monster.hp}`):console.error("未找到怪物血量元素");const u=o.querySelector(".monster-hp-bar");u?(console.log("更新怪物血量条宽度:",`${n.hp_percentage}%`),u.style.width=`${n.hp_percentage}%`):console.error("未找到怪物血量条元素")}}}this.handleCombatResult(t.data),this.isAutoAttacking&&!t.data.monster_killed&&!t.data.character_died&&setTimeout(()=>this.attackMonster(),1e3)}catch(t){console.error("攻击失败:",t),this.addMessage("攻击失败","error"),this.isAutoAttacking&&setTimeout(()=>this.attackMonster(),2e3)}}toggleAutoAttack(){this.isAutoAttacking=!this.isAutoAttacking;const e=document.getElementById("auto-attack-btn");this.isAutoAttacking?(e.textContent="停止自动",e.classList.add("active"),this.addMessage("已开启自动攻击","system"),this.attackMonster()):(e.textContent="自动攻击",e.classList.remove("active"),this.addMessage("已停止自动攻击","system"))}async useSkill(e,t){try{const n=await axios.post("/api/skill/use",{skill_id:e,monster_id:t});this.handleCombatResult(n.data);const o=document.getElementById("skill-select-modal");o&&(o.style.display="none")}catch(n){console.error("使用技能失败:",n),this.addMessage("使用技能失败")}}async buyItem(e){try{const t=await axios.post("/api/shop/buy",{shop_item_id:e,quantity:1});if(console.log("购买物品响应:",t.data),t.data.success){this.character.gold=t.data.current_gold;const n=document.querySelector(".player-gold");n&&(n.textContent=`您的金币: ${this.character.gold}`),t.data.inventory&&this.updateInventoryList(t.data.inventory),this.updateShopItemsAffordability(),this.addMessage(`成功购买 ${t.data.item_name}`,"success"),this.addMessage(`剩余金币: ${this.character.gold}`,"gold")}else this.addMessage(t.data.message||"购买失败","error")}catch(t){console.error("购买物品失败:",t);let n="购买失败";t.response&&t.response.data&&(n=t.response.data.message||n),this.addMessage(n,"error")}}updateShopItemsAffordability(){document.querySelectorAll("#shop-items .item").forEach(t=>{const n=t.querySelector(".price-info");if(n){const o=n.textContent.match(/价格：(\d+)金币/);if(o&&o[1]){const c=parseInt(o[1]);if((this.character.gold||0)>=c){t.classList.remove("cannot-afford"),t.classList.add("can-afford");const d=n.querySelector(".not-enough");d&&d.remove();const g=t.querySelector(".buy-btn");if(g){g.classList.remove("disabled"),g.removeAttribute("title");const b=t.dataset.shopItemId;g.setAttribute("onclick",`game.buyItem(${b})`)}}else{t.classList.remove("can-afford"),t.classList.add("cannot-afford"),n.querySelector(".not-enough")||(n.innerHTML=`价格：${c}金币 <span class="not-enough">(金币不足)</span>`);const d=t.querySelector(".buy-btn");d&&(d.classList.add("disabled"),d.setAttribute("title","金币不足"),d.removeAttribute("onclick"))}}}})}async useItem(e){try{const t=await axios.post("/api/item/use",{character_item_id:e});this.character=t.data.character,this.updateCharacterInfo(),this.updateInventoryList(t.data.inventory),this.addMessage(t.data.message);const n=document.getElementById("item-modal");n&&(n.style.display="none")}catch(t){console.error("使用物品失败:",t),this.addMessage("使用物品失败")}}async equipItem(e){try{const t=await axios.post("/api/item/equip",{character_item_id:e});this.character=t.data.character,this.updateCharacterInfo(),this.updateInventoryList(t.data.inventory),this.addMessage(t.data.message);const n=document.getElementById("item-modal");n&&(n.style.display="none")}catch(t){console.error("装备物品失败:",t),this.addMessage("装备物品失败")}}async unequipItem(e){try{const t=await axios.post("/api/item/unequip",{character_item_id:e});this.character=t.data.character,this.updateCharacterInfo(),this.updateInventoryList(t.data.inventory),this.addMessage(t.data.message);const n=document.getElementById("item-modal");n&&(n.style.display="none")}catch(t){console.error("卸下物品失败:",t),this.addMessage("卸下物品失败")}}async dropItem(e){try{const n=await axios.post("/api/item/drop",{character_item_id:e,quantity:1});this.updateInventoryList(n.data.inventory),this.addMessage(n.data.message);const o=document.getElementById("item-modal");o&&(o.style.display="none")}catch(n){console.error("丢弃物品失败:",n),this.addMessage("丢弃物品失败")}}handleCombatResult(e){if(e.success){console.log("处理战斗结果:",e),e.character&&(this.character=e.character,this.updateCharacterInfo());let t=`对怪物造成${e.damage}点伤害`,n="combat";if(e.monster_damage&&(t+=`，怪物反击造成${e.monster_damage}点伤害`,e.character_died)){this.addMessage(t,"error"),this.addMessage(e.respawn_message,"warning");const o=document.getElementById("monster-modal");o&&(o.style.display="none"),this.loadMapData();return}if(e.monster_killed){t+=`，击杀怪物获得${e.exp_gained}经验和${e.gold_gained}金币`,e.leveled_up&&(t+=`，升级到${e.new_level}级！`,n="success"),console.log("怪物被击杀，处理怪物死亡");const o=document.getElementById("monster-modal");if(!o){console.error("怪物模态框元素未找到");return}const c=o.dataset.monsterId,u=this.monsters.find(g=>g.id===parseInt(c));u&&(u.is_dead=!0,console.log("标记怪物为死亡状态:",u));const d=document.querySelector(`.monster[data-monster-id="${c}"]`);d?(console.log("从DOM中移除怪物元素"),d.remove()):console.error("未找到怪物元素，无法从DOM中移除"),o.style.display="none",this.updateMonsters()}this.addMessage(t,n),e.monster_killed&&e.gold_gained>0&&this.addMessage(`您获得了 ${e.gold_gained} 金币`,"gold")}else console.error("战斗失败:",e),this.addMessage("战斗失败","error")}handleGameEvent(e){if(console.log("处理游戏事件:",e),!e||!e.type){console.warn("收到无效的游戏事件:",e);return}switch(e.type){case"character.move":this.handleCharacterMove(e.data);break;case"character.enter":this.handleCharacterEnter(e.data);break;case"character.leave":this.handleCharacterExit(e.data);break;case"monster.damaged":this.handleMonsterDamaged(e.data);break;case"monster.killed":this.handleMonsterKilled(e.data);break;case"monster.respawning":this.handleMonsterRespawning(e.data);break;case"monster.respawned":this.handleMonsterRespawned(e.data);break;case"map.updated":this.handleMapUpdated(e.data);break;default:console.warn("未知的游戏事件类型:",e.type);break}}handleCharacterMove(e){if(!e||!e.character||!e.character.id||e.character.id===this.character.id){console.log("忽略移动事件:",e);return}console.log("收到角色移动事件:",e);let t=document.querySelector(`.other-player[data-player-id="${e.character.id}"]`);if(t){const n=parseFloat(t.style.left),o=parseFloat(t.style.top),c=e.character.position_x,u=e.character.position_y,d=Math.sqrt(Math.pow(c-n,2)+Math.pow(u-o,2)),b=Math.min(300,Math.max(d/2,100));console.log(`玩家 ${e.character.name} 移动: (${n}, ${o}) -> (${c}, ${u}), 距离: ${d}, 动画时间: ${b}ms`),this.addMessage(`${e.character.name} 移动到位置 (${c}, ${u})`),t.classList.add("moving"),t.style.transition=`left ${b}ms ease-out, top ${b}ms ease-out`,t.style.left=`${c}px`,t.style.top=`${u}px`,console.log(`更新玩家 ${e.character.name} 位置: (${c}, ${u}), CSS位置: left=${t.style.left}, top=${t.style.top}`),setTimeout(()=>{t.classList.remove("moving"),t.style.transition="none";const y=this.otherPlayers.findIndex(v=>v.id===e.character.id);y!==-1&&(this.otherPlayers[y].position_x=c,this.otherPlayers[y].position_y=u),console.log(`玩家 ${e.character.name} 移动完成, 最终位置: (${c}, ${u})`)},b)}else{if(console.log("创建新的玩家元素:",e.character),t=document.createElement("div"),t.className="player other-player",t.dataset.playerId=e.character.id,t.innerHTML=`${e.character.name} <span class="player-level">Lv.${e.character.level||1}</span>`,t.title=`${e.character.name} (等级 ${e.character.level||1})`,t.style.left=`${e.character.position_x}px`,t.style.top=`${e.character.position_y}px`,console.log(`设置新玩家 ${e.character.name} 初始位置: (${e.character.position_x}, ${e.character.position_y}), CSS位置: left=${t.style.left}, top=${t.style.top}`),this.gameMap)this.gameMap.appendChild(t),console.log("玩家元素已添加到地图"),this.addMessage(`${e.character.name} 出现在位置 (${e.character.position_x}, ${e.character.position_y})`);else{console.error("找不到地图容器");return}this.otherPlayers.find(n=>n.id===e.character.id)||(this.otherPlayers.push(e.character),console.log("玩家已添加到列表"))}}handleCharacterEnter(e){if(!e||!e.character){console.warn("接收到无效的角色进入事件:",e);return}const t=e.character;if(t.id===this.character.id){console.log("忽略自己的角色进入事件");return}console.log("角色进入地图:",t);const n=this.otherPlayers.findIndex(o=>o.id===t.id);n!==-1?(this.otherPlayers[n]=t,console.log("更新现有玩家信息:",t)):(this.otherPlayers.push(t),console.log("添加新玩家到列表:",t)),this.updateOtherPlayers(),this.addMessage(`${t.name} 进入了地图`)}handleCharacterExit(e){if(!e||!e.character_id){console.warn("接收到无效的角色离开事件:",e);return}const t=e.character_id;if(t===this.character.id){console.log("忽略自己的角色离开事件");return}console.log("角色离开地图:",t);const n=this.otherPlayers.find(c=>c.id===t),o=n?n.name:"一位玩家";this.otherPlayers=this.otherPlayers.filter(c=>c.id!==t),this.updateOtherPlayers(),this.addMessage(`${o} 离开了地图`)}handleMonsterDamaged(e){const t=this.monsters.find(n=>n.id===e.monster_id);if(t){t.current_hp=e.current_hp,t.hp_percentage=e.hp_percentage;const n=document.getElementById("monster-modal");if(n&&n.style.display==="block"){const o=n.querySelector(".monster-hp");o&&(o.textContent=`${e.current_hp}/${t.hp}`);const c=n.querySelector(".monster-hp-bar");c&&(c.style.width=`${e.hp_percentage}%`)}e.attacker_id!==this.character.id&&this.addMessage(`${e.attacker_name}对${e.monster_name}造成${e.damage}点伤害`)}}handleMonsterKilled(e){console.log("处理怪物死亡事件:",e);const t=this.monsters.find(n=>n.id===e.monster_id);if(t){console.log("找到被击杀的怪物:",t),t.current_hp=0,t.is_dead=!0;const n=document.querySelector(`.monster[data-monster-id="${e.monster_id}"]`);n?(console.log("从DOM中移除怪物元素"),n.remove()):console.error("未找到怪物元素，无法从DOM中移除"),this.updateMonsters(),e.killer_id!==this.character.id&&this.addMessage(`${e.killer_name}击杀了${e.monster_name}`)}else console.error("未找到被击杀的怪物:",e.monster_id)}handleMonsterRespawning(e){console.log("怪物即将重生:",e),this.addMessage(`${e.monster_name}将在${e.respawn_time}秒后重生`)}handleMonsterRespawned(e){console.log("怪物重生:",e);const t=this.monsters.findIndex(n=>n.id===e.monster_id);t!==-1?this.monsters[t]={...this.monsters[t],current_hp:e.current_hp,hp:e.hp,hp_percentage:e.hp_percentage,is_dead:!1,position_x:e.position_x,position_y:e.position_y}:this.monsters.push({id:e.monster_id,name:e.monster_name,current_hp:e.current_hp,hp:e.hp,hp_percentage:e.hp_percentage,is_dead:!1,position_x:e.position_x,position_y:e.position_y}),this.updateMonsters(),this.addMessage(`${e.monster_name}已重生`)}handleMapUpdated(e){this.addMessage(e.message,"info"),this.currentMap&&e.map_id===this.currentMap.id&&this.loadMapData().then(()=>{this.addMessage("地图数据已更新","success")})}addMessage(e,t="info"){if(!this.messages){console.warn("消息容器未找到，无法显示消息:",e);return}const n=document.createElement("p");n.textContent=e,n.classList.add("game-message",`message-${t}`);let o="";switch(t){case"error":o="❌ ";break;case"success":o="✅ ";break;case"warning":o="⚠️ ";break;case"gold":o="💰 ";break;case"combat":o="⚔️ ";break;case"system":o="🔧 ";break;case"info":default:o="ℹ️ "}n.textContent=o+e,n.classList.add("highlight"),setTimeout(()=>{n.classList.remove("highlight")},2e3),this.messages.appendChild(n),this.messages.scrollTop=this.messages.scrollHeight;const c=50;for(;this.messages.children.length>c;)this.messages.removeChild(this.messages.children[0])}cleanup(){this.skillCooldownInterval&&(clearInterval(this.skillCooldownInterval),this.skillCooldownInterval=null)}}document.addEventListener("DOMContentLoaded",()=>{window.game=new Ko});window.axios=j;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";const pn=document.querySelector('meta[name="csrf-token"]').getAttribute("content");pn?window.axios.defaults.headers.common["X-CSRF-TOKEN"]=pn:console.error("CSRF token not found");
